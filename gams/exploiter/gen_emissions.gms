********************************************************************************
$ontext

   Dairdyn project

   GAMS file : GEN_Feed.gms

   @purpose  : Generate summary results for pigs & fattners
   @author   : D.Schaefer
   @date     : 27.01.18
   @since    :
   @refDoc   :
   @seeAlso  :
   @calledBy :

$offtext
********************************************************************************

parameter p_emissionRes(*,*,*) "Emission related to different functional units, per source";
option kill = p_emissionRes;

* --- Emissions and environmental impact per ha for all farms

  p_emissionRes("EmissionPerha",source,emissions)    = ( sum((curChain,t_n(tCur,nCur)), p_probn(nCur) * v_emissionsYear.l(curChain,source,emissions,tCur,nCur)  )
                                                                        /  sum( (plot,t_n(tCur,nCur)) ,v_totPlotLand.l(plot,tCur,nCur) )    )   ;

  p_emissionRes("EmissionPerha","z_sum",emissions)   = ( sum((curChain,t_n(tCur,nCur),source), p_probn(nCur) * v_emissionsYear.l(curChain,source,emissions,tCur,nCur)  )
                                                                        /  sum( (plot,t_n(tCur,nCur)) ,v_totPlotLand.l(plot,tCur,nCur) )    )      ;

  p_emissionRes("EmissionPerha",source,emCat)        = ( sum((curChain,t_n(tCur,nCur)), p_probn(nCur) *   v_emissionsCat.l(curchain,source,emCat,tCur,nCur)  )
                                                                        /  sum( (plot,t_n(tCur,nCur)) ,v_totPlotLand.l(plot,tCur,nCur) )    )   ;

  p_emissionRes("EmissionPerha","z_sum",emCat)       = ( sum((curChain,t_n(tCur,nCur),source), p_probn(nCur) * v_emissionsCat.l(curchain,source,emCat,tCur,nCur)  )
                                                                          /  sum( (plot,t_n(tCur,nCur)) ,v_totPlotLand.l(plot,tCur,nCur) )    )      ;


$iftheni.fat "%farmBranchfattners%"    == "on"

* --- Emissions and environmental impact per pig for pig farms

  p_emissionRes("EmissionPerPig",source,emissions)  $ (sum( t_n(tCur,nCur),  v_branchSize.l("fatPig",tCur,nCur)   ) ne 0)
                                                  = sum((curChain,t_n(tCur,nCur)), p_probn(nCur) * v_emissionsYear.l(curChain,source,emissions,tCur,nCur)  )
                                                                / sum( t_n(tCur,nCur),  v_branchSize.l("fatPig",tCur,nCur) );


  p_emissionRes("EmissionPerPig","z_sum",emissions) $ (sum( t_n(tCur,nCur),  v_branchSize.l("fatPig",tCur,nCur)   ) ne 0)
                                                  = sum((curChain,t_n(tCur,nCur),source), p_probn(nCur) * v_emissionsYear.l(curChain,source,emissions,tCur,nCur)  )
                                                                / sum( t_n(tCur,nCur),  v_branchSize.l("fatPig",tCur,nCur) );


  p_emissionRes("EmissionPerPig",source,emCat)      $ (sum( t_n(tCur,nCur),  v_branchSize.l("fatPig",tCur,nCur)   ) ne 0)
                                                  = sum((curChain,t_n(tCur,nCur)), p_probn(nCur) *  v_emissionsCat.l(curchain,source,emCat,tCur,nCur)   )
                                                                / sum( t_n(tCur,nCur),  v_branchSize.l("fatPig",tCur,nCur) );


  p_emissionRes("EmissionPerPig","z_sum",emCat)     $ (sum( t_n(tCur,nCur),  v_branchSize.l("fatPig",tCur,nCur)   ) ne 0)
                                                  = sum((curChain,t_n(tCur,nCur),source), p_probn(nCur) *  v_emissionsCat.l(curchain,source,emCat,tCur,nCur)   )
                                                                / sum( t_n(tCur,nCur),  v_branchSize.l("fatPig",tCur,nCur) );



* --- Emissions and environmental impact per kg pig meat for pig farms

  p_emissionRes("EmissionPerkgMeat",source,emissions)  $ (sum( t_n(tCur,nCur),  v_branchSize.l("fatPig",tCur,nCur)   ) ne 0)
                                                       = sum((curChain,t_n(tCur,nCur)), p_probn(nCur) * v_emissionsYear.l(curChain,source,emissions,tCur,nCur)  )
                                                                  / sum( (sys,t_n(tCur,nCur) ), v_saleQuant.l("pigmeat",sys,tCur,nCur));


  p_emissionRes("EmissionPerkgMeat","z_sum",emissions) $ (sum( t_n(tCur,nCur),  v_branchSize.l("fatPig",tCur,nCur)   ) ne 0)
                                                       = sum((curChain,t_n(tCur,nCur),source), p_probn(nCur) * v_emissionsYear.l(curChain,source,emissions,tCur,nCur)  )
                                                                  / sum( (sys,t_n(tCur,nCur) ), v_saleQuant.l("pigmeat",sys,tCur,nCur));


  p_emissionRes("EmissionPerkgMeat",source,emCat)      $ (sum( t_n(tCur,nCur),  v_branchSize.l("fatPig",tCur,nCur)   ) ne 0)
                                                       = sum((curChain,t_n(tCur,nCur)), p_probn(nCur) * v_emissionsCat.l(curchain,source,emCat,tCur,nCur)   )
                                                                  / sum( (sys,t_n(tCur,nCur) ), v_saleQuant.l("pigmeat",sys,tCur,nCur));


  p_emissionRes("EmissionPerkgMeat","z_sum",emCat)     $ (sum( t_n(tCur,nCur),  v_branchSize.l("fatPig",tCur,nCur)   ) ne 0)
                                                       = sum((curChain,t_n(tCur,nCur),source), p_probn(nCur) * v_emissionsCat.l(curchain,source,emCat,tCur,nCur)   )
                                                                  / sum( (sys,t_n(tCur,nCur) ), v_saleQuant.l("pigmeat",sys,tCur,nCur));


$endif.fat


$iftheni.dairy %dairyherd% == true

* --- Emissions and environmental impact per cow for dairy farms

  p_emissionRes("EmissionPerCow",source,emissions)  $ (sum( t_n(tCur,nCur),  v_branchSize.l("dairy",tCur,nCur)   ) ne 0)
                                                    = sum((curChain,t_n(tCur,nCur)), p_probn(nCur) * v_emissionsYear.l(curChain,source,emissions,tCur,nCur)  )
                                                                  / sum( t_n(tCur,nCur),  v_branchSize.l("dairy",tCur,nCur) );


  p_emissionRes("EmissionPerCow","z_sum",emissions) $ (sum( t_n(tCur,nCur),  v_branchSize.l("dairy",tCur,nCur)   ) ne 0)
                                                    = sum((curChain,t_n(tCur,nCur),source), p_probn(nCur) * v_emissionsYear.l(curChain,source,emissions,tCur,nCur)  )
                                                                  / sum( t_n(tCur,nCur),  v_branchSize.l("dairy",tCur,nCur) );


  p_emissionRes("EmissionPerCow",source,emCat)      $ (sum( t_n(tCur,nCur),  v_branchSize.l("dairy",tCur,nCur)   ) ne 0)
                                                    = sum((curChain,t_n(tCur,nCur)), p_probn(nCur) * v_emissionsCat.l(curchain,source,emCat,tCur,nCur)  )
                                                                  / sum( t_n(tCur,nCur),  v_branchSize.l("dairy",tCur,nCur) );


  p_emissionRes("EmissionPerCow","z_sum",emCat)     $ (sum( t_n(tCur,nCur),  v_branchSize.l("dairy",tCur,nCur)   ) ne 0)
                                                    = sum((curChain,t_n(tCur,nCur),source), p_probn(nCur) * v_emissionsCat.l(curchain,source,emCat,tCur,nCur)  )
                                                                  / sum( t_n(tCur,nCur),  v_branchSize.l("dairy",tCur,nCur) );


* --- Emissions and environmental impact per kg milk for dairy far

  p_emissionRes("EmissionPerkgMilk",source,emissions)   $ (sum( t_n(tCur,nCur),  v_branchSize.l("dairy",tCur,nCur)   ) ne 0)
                                                        = sum((curChain,t_n(tCur,nCur)), p_probn(nCur) * v_emissionsYear.l(curChain,source,emissions,tCur,nCur)  )
                                                                           / sum( (sys,t_n(tCur,nCur) ), v_saleQuant.l("milk",sys,tCur,nCur) * 1000);

  p_emissionRes("EmissionPerkgMilk","z_sum",emissions)  $ (sum( t_n(tCur,nCur),  v_branchSize.l("dairy",tCur,nCur)   ) ne 0)
                                                        = sum((curChain,t_n(tCur,nCur),source), p_probn(nCur) * v_emissionsYear.l(curChain,source,emissions,tCur,nCur)  )
                                                                            / sum( (sys,t_n(tCur,nCur) ), v_saleQuant.l("milk",sys,tCur,nCur) * 1000);

  p_emissionRes("EmissionPerkgMilk",source,emCat)       $ (sum( t_n(tCur,nCur),  v_branchSize.l("dairy",tCur,nCur)   ) ne 0)
                                                        = sum((curChain,t_n(tCur,nCur)), p_probn(nCur) *  v_emissionsCat.l(curchain,source,emCat,tCur,nCur)  )
                                                                           / sum( (sys,t_n(tCur,nCur) ), v_saleQuant.l("milk",sys,tCur,nCur) * 1000);

  p_emissionRes("EmissionPerkgMilk","z_sum",emCat)      $ (sum( t_n(tCur,nCur),  v_branchSize.l("dairy",tCur,nCur)   ) ne 0)
                                                        = sum((curChain,t_n(tCur,nCur),source), p_probn(nCur) *  v_emissionsCat.l(curchain,source,emCat,tCur,nCur)  )
                                                                           / sum( (sys,t_n(tCur,nCur) ), v_saleQuant.l("milk",sys,tCur,nCur) * 1000);
$endif.dairy

$iftheni.sows "%farmBranchSows%"    == "on"

* --- Emissions and environmental impact per sow for pig raising farms

  p_emissionRes("EmissionPerSow",source,emissions)  $ (sum( t_n(tCur,nCur),  v_branchSize.l("sowPig",tCur,nCur)   ) ne 0)
                                                    = sum((curChain,t_n(tCur,nCur)), p_probn(nCur) * v_emissionsYear.l(curChain,source,emissions,tCur,nCur)  )
                                                                            / sum( t_n(tCur,nCur),  v_branchSize.l("sowPig",tCur,nCur));

  p_emissionRes("EmissionPerSow","z_sum",emissions) $ (sum( t_n(tCur,nCur),  v_branchSize.l("sowPig",tCur,nCur)   ) ne 0)
                                                    = sum((curChain,t_n(tCur,nCur),source), p_probn(nCur) * v_emissionsYear.l(curChain,source,emissions,tCur,nCur)  )
                                                                            / sum( t_n(tCur,nCur),  v_branchSize.l("sowPig",tCur,nCur));

  p_emissionRes("EmissionPerSow",source,emCat)      $ (sum( t_n(tCur,nCur),  v_branchSize.l("sowPig",tCur,nCur)   ) ne 0)
                                                    = sum((curChain,t_n(tCur,nCur)), p_probn(nCur) * v_emissionsCat.l(curchain,source,emCat,tCur,nCur)  )
                                                                            / sum( t_n(tCur,nCur),  v_branchSize.l("sowPig",tCur,nCur));

  p_emissionRes("EmissionPerSow","z_sum",emCat)     $ (sum( t_n(tCur,nCur),  v_branchSize.l("sowPig",tCur,nCur)   ) ne 0)
                                                    = sum((curChain,t_n(tCur,nCur),source), p_probn(nCur) * v_emissionsCat.l(curchain,source,emCat,tCur,nCur)  )
                                                                            / sum( t_n(tCur,nCur),  v_branchSize.l("sowPig",tCur,nCur));

* --- Emissions and environmental impact per piglet produced for pig raising farms

  p_emissionRes("EmissionPerPiglet",source,emissions)   $ (sum( t_n(tCur,nCur),  v_branchSize.l("sowPig",tCur,nCur)   ) ne 0)
                                                        = sum((curChain,t_n(tCur,nCur)), p_probn(nCur) * v_emissionsYear.l(curChain,source,emissions,tCur,nCur)  )
                                                                            / sum( (sys,t_n(tCur,nCur) ), v_saleQuant.l("pigletsSold",sys,tCur,nCur));


  p_emissionRes("EmissionPerPiglet","z_sum",emissions)  $ (sum( t_n(tCur,nCur),  v_branchSize.l("sowPig",tCur,nCur)   ) ne 0)
                                                        = sum((curChain,t_n(tCur,nCur),source), p_probn(nCur) * v_emissionsYear.l(curChain,source,emissions,tCur,nCur)  )
                                                                            / sum( (sys,t_n(tCur,nCur) ), v_saleQuant.l("pigletsSold",sys,tCur,nCur));


  p_emissionRes("EmissionPerPiglet",source,emCat)       $ (sum( t_n(tCur,nCur),  v_branchSize.l("sowPig",tCur,nCur)   ) ne 0)
                                                        = sum((curChain,t_n(tCur,nCur)), p_probn(nCur) *  v_emissionsCat.l(curchain,source,emCat,tCur,nCur)  )
                                                                            / sum( (sys,t_n(tCur,nCur) ), v_saleQuant.l("pigletsSold",sys,tCur,nCur));


  p_emissionRes("EmissionPerPiglet","z_sum",emCat)      $ (sum( t_n(tCur,nCur),  v_branchSize.l("sowPig",tCur,nCur)   ) ne 0)
                                                        = sum((curChain,t_n(tCur,nCur),source), p_probn(nCur) *  v_emissionsCat.l(curchain,source,emCat,tCur,nCur)  )
                                                                            / sum( (sys,t_n(tCur,nCur) ), v_saleQuant.l("pigletsSold",sys,tCur,nCur));

$endif.sows
$iftheni.bulls "%farmBranchBeef%"    == "on"

* --- Emissions and environmental impact per bull for beef fattening farms

  p_emissionRes("EmissionPerBull",source,emissions)  $ (sum( t_n(tCur,nCur),  v_branchSize.l("Beef",tCur,nCur)   ) ne 0)
                                                     = sum((curChain,t_n(tCur,nCur)), p_probn(nCur) * v_emissionsYear.l(curChain,source,emissions,tCur,nCur)  )
                                                                          / sum( t_n(tCur,nCur),  v_branchSize.l("Beef",tCur,nCur) );


  p_emissionRes("EmissionPerBull","z_sum",emissions) $ (sum( t_n(tCur,nCur),  v_branchSize.l("Beef",tCur,nCur)   ) ne 0)
                                                     = sum((curChain,t_n(tCur,nCur),source), p_probn(nCur) * v_emissionsYear.l(curChain,source,emissions,tCur,nCur)  )
                                                                          / sum( t_n(tCur,nCur),  v_branchSize.l("Beef",tCur,nCur));


  p_emissionRes("EmissionPerBull",source,emCat)      $ (sum( t_n(tCur,nCur),  v_branchSize.l("Beef",tCur,nCur)   ) ne 0)
                                                     = sum((curChain,t_n(tCur,nCur)), p_probn(nCur) *  v_emissionsCat.l(curchain,source,emCat,tCur,nCur)   )
                                                                          / sum( t_n(tCur,nCur),  v_branchSize.l("Beef",tCur,nCur));


  p_emissionRes("EmissionPerBull","z_sum",emCat)     $ (sum( t_n(tCur,nCur),  v_branchSize.l("Beef",tCur,nCur)   ) ne 0)
                                                     = sum((curChain,t_n(tCur,nCur),source), p_probn(nCur) *  v_emissionsCat.l(curchain,source,emCat,tCur,nCur)   )
                                                                          / sum( t_n(tCur,nCur),  v_branchSize.l("Beef",tCur,nCur));



* --- Emissions and environmental impact per kg beef for beef fattening farms

  p_emissionRes("emissionPerkgBeef",source,emissions)  $ (sum( t_n(tCur,nCur),  v_branchSize.l("Beef",tCur,nCur)   ) ne 0)
                                                       = sum((curChain,t_n(tCur,nCur)), p_probn(nCur) * v_emissionsYear.l(curChain,source,emissions,tCur,nCur)  )
                                                                / sum( (sys,t_n(tCur,nCur),allBeef_outputs(prodsYearly)), v_saleQuant.l(prodsYearly,sys,tCur,nCur));


  p_emissionRes("emissionPerkgBeef","z_sum",emissions) $ (sum( t_n(tCur,nCur),  v_branchSize.l("Beef",tCur,nCur)   ) ne 0)
                                                       = sum((curChain,t_n(tCur,nCur),source), p_probn(nCur) * v_emissionsYear.l(curChain,source,emissions,tCur,nCur)  )
                                                                / sum( (sys,t_n(tCur,nCur),allBeef_outputs(prodsYearly) ), v_saleQuant.l(prodsYearly,sys,tCur,nCur));


  p_emissionRes("emissionPerkgBeef",source,emCat)      $ (sum( t_n(tCur,nCur),  v_branchSize.l("Beef",tCur,nCur)   ) ne 0)
                                                       = sum((curChain,t_n(tCur,nCur)), p_probn(nCur) * v_emissionsCat.l(curchain,source,emCat,tCur,nCur)   )
                                                                / sum( (sys,t_n(tCur,nCur),allBeef_outputs(prodsYearly) ), v_saleQuant.l(prodsYearly,sys,tCur,nCur));


  p_emissionRes("emissionPerkgBeef","z_sum",emCat)     $ (sum( t_n(tCur,nCur),  v_branchSize.l("Beef",tCur,nCur)   ) ne 0)
                                                       = sum((curChain,t_n(tCur,nCur),source), p_probn(nCur) * v_emissionsCat.l(curchain,source,emCat,tCur,nCur)   )
                                                                / sum( (sys,t_n(tCur,nCur),allBeef_outputs(prodsYearly) ), v_saleQuant.l(prodsYearly,sys,tCur,nCur));


$endif.bulls
$iftheni.mcows %farmBranchMotherCows% == on

* --- Emissions and environmental impact per suckler cow for suckler cow herds

  p_emissionRes("EmissionPerMCow",source,emissions) $ (sum( t_n(tCur,nCur),  v_branchSize.l("motherCows",tCur,nCur)   ) ne 0)
                                                                    =  sum((curChain,t_n(tCur,nCur)), p_probn(nCur) * v_emissionsYear.l(curChain,source,emissions,tCur,nCur)  )
                                                                          / sum( t_n(tCur,nCur),  v_branchSize.l("motherCows",tCur,nCur));

  p_emissionRes("EmissionPerMCow","z_sum",emissions) $ (sum( t_n(tCur,nCur),  v_branchSize.l("motherCows",tCur,nCur)   ) ne 0)
                                                                    =  sum((curChain,t_n(tCur,nCur),source), p_probn(nCur) * v_emissionsYear.l(curChain,source,emissions,tCur,nCur)  )
                                                                          / sum( t_n(tCur,nCur),  v_branchSize.l("motherCows",tCur,nCur));

  p_emissionRes("EmissionPerMCow",source,emCat) $ (sum( t_n(tCur,nCur),  v_branchSize.l("motherCows",tCur,nCur)   ) ne 0)
                                                                    =  sum((curChain,t_n(tCur,nCur)), p_probn(nCur) *  v_emissionsCat.l(curchain,source,emCat,tCur,nCur)   )
                                                                          / sum( t_n(tCur,nCur),  v_branchSize.l("motherCows",tCur,nCur));


  p_emissionRes("EmissionPerMCow","z_sum",emCat) $ (sum( t_n(tCur,nCur),  v_branchSize.l("motherCows",tCur,nCur)   ) ne 0)
                                                                    =  sum((curChain,t_n(tCur,nCur),source), p_probn(nCur) *  v_emissionsCat.l(curchain,source,emCat,tCur,nCur)   )
                                                                          / sum( t_n(tCur,nCur),  v_branchSize.l("motherCows",tCur,nCur));


* --- Emissions and environmental impact per kg beef for suckler cow herds

  p_emissionRes("EmissionPerkgMbeef",source,emissions) $ (sum( t_n(tCur,nCur),  v_branchSize.l("motherCows",tCur,nCur)   ) ne 0)
                                                                   =  sum((curChain,t_n(tCur,nCur)), p_probn(nCur) * v_emissionsYear.l(curChain,source,emissions,tCur,nCur)  )
                                                                           / sum( (sys,t_n(tCur,nCur),beefout(prodsYearly) ), v_saleQuant.l(prodsYearly,sys,tCur,nCur))
                                                                           ;

  p_emissionRes("EmissionPerkgMbeef","z_sum",emissions) $ (sum( t_n(tCur,nCur),  v_branchSize.l("motherCows",tCur,nCur)   ) ne 0)
                                                                   =  sum((curChain,t_n(tCur,nCur),source), p_probn(nCur) * v_emissionsYear.l(curChain,source,emissions,tCur,nCur)  )
                                                                           / sum( (sys,t_n(tCur,nCur),beefout(prodsYearly) ), v_saleQuant.l(prodsYearly,sys,tCur,nCur));

  p_emissionRes("EmissionPerkgMbeef",source,emCat)   $ (sum( t_n(tCur,nCur),  v_branchSize.l("motherCows",tCur,nCur)   ) ne 0)
                                                                   =  sum((curChain,t_n(tCur,nCur)), p_probn(nCur) * v_emissionsCat.l(curchain,source,emCat,tCur,nCur)   )
                                                                           / sum( (sys,t_n(tCur,nCur),beefout(prodsYearly) ), v_saleQuant.l(prodsYearly,sys,tCur,nCur));

  p_emissionRes("EmissionPerkgMbeef","z_sum",emCat) $ (sum( t_n(tCur,nCur),  v_branchSize.l("motherCows",tCur,nCur)   ) ne 0)
                                                                   =  sum((curChain,t_n(tCur,nCur),source), p_probn(nCur) * v_emissionsCat.l(curchain,source,emCat,tCur,nCur)   )
                                                                            / sum( (sys,t_n(tCur,nCur),beefout(prodsYearly) ), v_saleQuant.l(prodsYearly,sys,tCur,nCur));

$endif.mcows
option p_emissionRes:5:1:1;
display p_emissionRes;
