*
*   --- sales revenue of crops
*   1) revenues
*

$iftheni.defCmCols not defined cmCols

set cmCols        / Price, Amount, Total /;

set cmRows   / Revenues,Revenues1,Revenue_resid,MilkRevenue, OldCowRevenue, CalvRevenue, Replacements,Rearing, Feed,
                    Concentrates, Roughages, SexingCosts, Seeds, SyntFertilizer, AHL, ASS, PK18, KAS, Lime, LiquidManure,
                    SolidManure, Pesticides, Fungicides, Herbicides, Insecticides, WaterCosts,
                    Insurance, DirectCostFreeRev, MachineCosts, ContractWork, OtherCosts, VariableCosts,ContributionMargin, StableFixCosts,
                    "Land duals","Labour duals","EFA duals","Crop share restr. duals","Nutbal duals","Remaining duals" /;

$endif.defCmCols


$iftheni.arable %arable%==true

$ifi not defined  p_resCMCrops parameter p_resCMCrops(crops,t,cmRows,cmCols);
*
*  --- calculation of prices for gross margin rows
*
   p_resCMCrops(curCrops(crops),tCur,"Revenues","Price") $ p_res(%1,%2,crops,"levl",%3,tCur)
           = p_res(%1,%2,crops,"Price",%3,tCur);
*
*  --- revenues-costs for crop residues
*
   p_resCMCrops(curCrops(crops),tCur,"Revenue_resid","Total") $ (p_res(%1,%2,crops,"levl",%3,tCur) $ cropsResidueRemo(crops))
           = sum( (c_p_t_i(crops,plot,till,intens),t_n(tCur,nCur)) $ v_cropHa.l(crops,plot,till,intens,tCur,nCur),
                       residueRemoval_.m(crops,plot,till,tCur,nCur)
                              * v_cropHa.l(crops,plot,till,intens,tCur,nCur))
                                    /p_res(%1,%2,crops,"levl",%3,tCur);

*  --- if no price is given for a product (e.g grass), the shadow price is used instead (in store_res)

  p_resCMCrops(curCrops(crops),tCur,"Revenues","Price") $ (p_res(%1,%2,crops,"levl",%3,tCur)
                                                         $ (not p_resCMCrops(crops,tCur,"Revenues","Price"))
                                                         $ (p_res(%1,%2,crops,"yield",%3,tCur)))
        =  p_res(%1,%2,crops,"reve",%3,tCur) / p_res(%1,%2,crops,"yield",%3,tCur);

*
*  --- calculation of amounts for gross margin rows
*
   p_resCMCrops(curCrops(crops),tCur,"Revenues","Amount") $ p_res(%1,%2,crops,"levl",%3,tCur)
        = p_res(%1,%2,crops,"yield",%3,tCur);
*
*  --- calculation of sums / totals for gross margin rows
*
   p_resCMCrops(curCrops(crops),tCur,"Revenues","Total") $ p_res(%1,%2,crops,"levl",%3,tCur)
           = p_res(%1,%2,crops,"reve",%3,tCur);

   p_resCMCrops(curCrops(crops),tCur,"Seeds","Total") $ p_res(%1,%2,crops,"levl",%3,tCur)
           = p_res(%1,%2,crops,"Seed",%3,tCur);

   p_resCMCrops(curCrops(crops),tCur,"SyntFertilizer","Total") $ p_res(%1,%2,crops,"levl",%3,tCur)
           = sum(syntFertilizer , p_res(%1,%2,crops,syntFertilizer,%3,tCur));

   p_resCMCrops(curCrops(crops),tCur,"Pesticides","Total") $ p_res(%1,%2,crops,"levl",%3,tCur)
           = sum(set_pesticides, p_res(%1,%2,crops,set_pesticides,%3,tCur));

   p_resCMCrops(curCrops(crops),tCur,"OtherCosts","Total") $ p_res(%1,%2,crops,"levl",%3,tCur)
           = sum( (t_n(tCur,nCur),c_p_t_i(crops,plot,till,intens)) $ v_cropHa.l(crops,plot,till,intens,tCur,nCur),
                 [ (p_vCostC(crops,till,intens,tCur) + p_fCostC(crops,till,intens,tCur)) * p_probN(nCur)
                 - p_costQuant(crops,till,intens,"lime")
                 / (p_inputPrices("lime","conv")  $ (not sameas(till,"org"))
                    + p_inputPrices("lime","org") $ (    sameas(till,"org")))   
                 * v_costQuant(crops,"Lime")        * buy_.m("Lime",tCur,nCur)
                 - sum(branches_to_acts(branches,crops),branchSize_.m(branches,tcur,nCur))
                 ] * v_cropHa.l(crops,plot,till,intens,tCur,nCur))
             /p_res(%1,%2,crops,"levl",%3,tCur);

   p_resCMCrops(curCrops(crops),tCur,"MachineCosts","Total") $ p_res(%1,%2,crops,"levl",%3,tCur)
        = sum( (t_n(tCur,nCur),c_p_t_i(crops,plot,till,intens)) $ v_cropHa.l(crops,plot,till,intens,tCur,nCur),

           [

            - p_costQuant(crops,till,intens,"diesel") * v_costQuant(crops,"diesel") * buy_.m("diesel",tCur,nCur)

            + sum(  machType,

                 p_machNeed(crops,till,intens,machType,"ha")   * machines_.m(machType,"ha",tCur,nCur)
               + p_machNeed(crops,till,intens,machType,"hour") * machines_.m(machType,"hour",tCur,nCur)
                              $ (not p_machNeed(crops,till,intens,machType,"ha")))

        ] * v_cropHa.l(crops,plot,till,intens,tCur,nCur)
*
         )/p_res(%1,%2,crops,"levl",%3,tCur);

   p_resCMCrops(curCrops(crops),tCur,"WaterCosts","Total") $ p_res(%1,%2,crops,"levl",%3,tCur)
        = p_res(%1,%2,crops,"Water",%3,tCur);

   p_resCMCrops(curCrops(crops),tCur,"Insurance","Total") $ p_res(%1,%2,crops,"levl",%3,tCur)
        = p_res(%1,%2,crops,"hailins",%3,tCur);

   p_resCMCrops(curCrops(crops),tCur,"VariableCosts","Total") $ p_res(%1,%2,crops,"levl",%3,tCur)
        = p_resCMCrops(crops,tCur,"Insurance","Total")
        + p_resCMCrops(crops,tCur,"WaterCosts","Total")
        + p_resCMCrops(crops,tCur,"MachineCosts","Total")
        + p_resCMCrops(crops,tCur,"otherCosts","Total")
        + p_resCMCrops(crops,tCur,"Pesticides","Total")
        + p_resCMCrops(crops,tCur,"SyntFertilizer","Total")
        + p_resCMCrops(crops,tCur,"Seeds","Total");

   p_resCMCrops(curCrops(crops),tCur,"ContributionMargin","Total") $ p_res(%1,%2,crops,"levl",%3,tCur)
       = p_resCMCrops(crops,tCur,"Revenues","Total")
         + p_resCMCrops(crops,tCur,"Revenue_resid","Total")
         - p_resCMCrops(crops,tCur,"VariableCosts","Total");

   p_resCMCrops(curCrops(crops),tCur,"Labour duals","Total") $ p_res(%1,%2,crops,"levl",%3,tCur)
     = sum( (c_p_t_i(crops,plot,till,intens),t_n(tCur,nCur),m) $ v_cropHa.l(crops,plot,till,intens,tCur,nCur),
                      -p_cropLab(crops,till,intens,m) *  labCropSM_.m(tCur,nCur,m) * v_cropHa.l(crops,plot,till,intens,tCur,nCur))
                       /p_res(%1,%2,crops,"levl",%3,tCur);


   p_resCMCrops(curCrops(crops),tCur,"Land duals","Total") $ p_res(%1,%2,crops,"levl",%3,tCur)
     = sum( (c_p_t_i(crops,plot,till,intens),t_n(tCur,nCur)) $ v_cropHa.l(crops,plot,till,intens,tCur,nCur),
                 ( -sum(sys $ (sameas(till,sys) or (sameas(sys,"conv") and (not sameas(till,"org")))), croppedPlotLand_.m(plot,sys,tCur,nCur))
         $$ifi defined fixGrasLand_          +FixGrasLand_.m(tCur,nCur) $ grassCrops(crops)
         $$ifi defined fixGrasLand_          +FixPastLand_.m(tCur,nCur) $ gras(crops)
                   -sum(plot_lt_soil(plot,landType,soil),croppedLand_.m(landType,soil,tCur,nCur)))
                   * v_cropHa.l(crops,plot,till,intens,tCur,nCur))
                      /p_res(%1,%2,crops,"levl",%3,tCur);

   $$iftheni.greening defined efa_

      p_resCMCrops(curCrops(crops),tCur,"EFA duals","Total") $ p_res(%1,%2,crops,"levl",%3,tCur)
           = sum( (t_n(tCur,nCur),c_p_t_i(crops,plot,till,intens)) $ v_cropHa.l(crops,plot,till,intens,tCur,nCur),
                    ( -efa_.m(tCur,nCur)*p_efa(crops) $ plot_landType(plot,"arab")
                          - sum(cropGroups $ p_cropGroups_to_crops(cropGroups,crops),haCropGroups_.m(cropGroups,tCur,nCur))
                          - (triggerGras75_.m(tCur,nCur)/0.75) $ grassCrops(crops)
                        ) * v_cropHa.l(crops,plot,till,intens,tCur,nCur))
                            /p_res(%1,%2,crops,"levl",%3,tCur);

   $$endif.greening

   p_resCMCrops(curCrops(crops),tCur,"Crop share restr. duals","Total") $ p_res(%1,%2,crops,"levl",%3,tCur)
     = sum( (landType,c_p_t_i(crops,plot,till,intens),sys,t_n(tCur,nCur)) $ (v_cropHa.l(crops,plot,till,intens,tCur,nCur) $ sys_till(sys,till) $  crops_t_landType(crops,landType) ),
                  (
      $$ifi defined cropRotMax_       cropRotMax_.m(landType,crops,sys,plot,tCur,nCur)
      $$ifi defined cropRotMin_      -cropRotMin_.m(landType,crops,sys,plot,tCur,nCur)
      $$ifi defined cropGrpRotMax_   +sum(cropShareGrp_crops(cropShareGrp,crops),cropGrpRotMax_.m(landType,cropShareGrp,sys,plot,tCur,nCur))
                    -sum(sys_till(sys,till),sumCrop_.m(crops,sys,tCur,nCur))
                  ) * v_cropHa.l(crops,plot,till,intens,tCur,nCur))
                      /p_res(%1,%2,crops,"levl",%3,tCur);

   p_resCMCrops(curCrops(crops),tCur,"NutBal duals","Total") $ p_res(%1,%2,crops,"levl",%3,tCur)
     = sum( (c_p_t_i(crops,plot,till,intens),t_n(tCur,nCur)) $ v_cropHa.l(crops,plot,till,intens,tCur,nCur),

                     [sum((nut,plot_soil(plot,soil)),
                      $$ifthen.nutBalPast defined nutBalPast_
                         sum(m,NutBalPast_.m(crops,plot,till,intens,nut,tCur,nCur,m)*
                                  p_pastNeedMonthly(crops,soil,till,intens,nut,tCur,m)*0.5) $ pastCrops(crops)
                       $$endif.nutBalPast
                        -NutBalCropSour_.m("NBCropNeed",crops,plot,till,intens,nut,tCur,nCur)*
                         $$iftheni.fert %Fertilization% == FertilizationOrdinance
*                         Fertilization Ordinance - Predefined by ordinance
                         p_NneedFerPlan(crops,soil,till,intens,nut,tCur)
                          $$else.fert
*                             Default - corresponds to nutrient removal
                              p_nutNeed(crops,soil,till,intens,nut,tCur)
                       $$endif.fert

                    - NutBalCropSour_.m("NBBasNut",crops,plot,till,intens,nut,tCur,nCur)*
                        $$iftheni.fert %Fertilization% == Default
                            sum(soilNutSour,p_basNut(crops,soil,till,soilNutSour,nut,tCur))
                       $$else.fert
                           p_NutFromSoil(crops,soil,till,nut,tCur)
                       $$endif.fert

                    - nMinMin_.m(crops,plot,till,intens,nut,tCur,nCur) * p_minChemFert(crops,nut)


                    -  NutBalCropSour_.m("NBLegumes",crops,plot,till,intens,nut,tCur,nCur)*
                        (  p_NfromLegumes(Crops,"org")  $ sameas(till,"org")
                         + p_NfromLegumes(Crops,"conv") $ (not sameas(till,"org"))) $ sameas(nut,"n")
          $$ifthen.vege defined p_NfromVegetables
                   -  NutBalCropSour_.m("NBvegetables",crops,plot,till,intens,nut,tCur,nCur)*
                       (  p_NfromVegetables(Crops) ) $ sameas(nut,"n")
         $$endif.vege

         $$ifthen.DUEVorgN defined DuevOrgNLimit_
                    -  DuevOrgNLimit_.m(tCur,nCur) * p_nutManApplLimit(crops,tCur) $ sameas(nut,"n")
         $$endif.DUEVorgN

         $$ifthen.DUEVfertQuota defined fertQuotaNeed_
                    -  FertQuotaNeed_.m(crops,plot,till,intens,nut,tCur,NCur) *
                          (      p_NneedFerPlan(crops,soil,till,intens,nut,tCur)
                             -   p_NutFromSoil(crops,soil,till,nut,tCur))
         $$endif.DUEVfertQuota

                    )
         $$ifthen.nLimitAutumn defined nLimitAutumn_
                       + nLimitAutumn_.m(crops,plot,till,intens,tCur,nCur) * p_NLimitInAutumn(crops,plot)
         $$endif.nLimitAutumn
                    ]  * v_cropHa.l(crops,plot,till,intens,tCur,nCur))
                      /p_res(%1,%2,crops,"levl",%3,tCur)
        - p_resCMCrops(crops,tCur,"SyntFertilizer","Total");

   p_resCMCrops(curCrops(crops),tCur,"Remaining duals","Total") $ p_res(%1,%2,crops,"levl",%3,tCur)
     =  p_resCMCrops(crops,tCur,"ContributionMargin","Total")
      - p_resCMCrops(crops,tCur,"Land duals","Total")
      - p_resCMCrops(crops,tCur,"Labour duals","Total")
      - p_resCMCrops(crops,tCur,"EFA duals","Total")
      - p_resCMCrops(crops,tCur,"Nutbal duals","Total")
      - p_resCMCrops(crops,tCur,"Crop share restr. duals","Total");

   p_resCMCrops(curCrops(crops),tCur,"Remaining duals","Total")
    $ (p_res(%1,%2,crops,"levl",%3,tCur) $ ( abs(p_resCMCrops(crops,tCur,"Remaining duals","Total")) le 0.1)) = 0;

   option p_resCMCrops:1:3:1;
   display p_resCMCrops;
$endif.arable
*
*   --- Dual analysis for animals
*
$ifthen.herd "%herd%"=="true"

    $$if not defined p_resCMAnim parameter p_resCMAnim(herds,*,t,*);set VQ / Q "Quant", V "Value" /;


   p_resCMAnim(possHerds,"#",tCur,"Q")
        = sum( (actHerds(possHerds,breeds,feedRegime,tCur,m),t_n(tCur,nCur)),
                            v_herdSize(possHerds,breeds,feedRegime,tCur,nCur,m)*p_probn(nCur))/card(m);

   p_resCMAnim(possHerds,prodsYearly,tCur,VQ)$ p_resCMAnim(possHerds,"#",tCur,"Q")
        = sum( (actHerds(possHerds,breeds,feedRegime,tCur,m),t_n(tCur,nCur)) $ p_OCoeff(possHerds,prodsYearly,breeds,tCur),
                           v_herdSize(possHerds,breeds,feedRegime,tCur,nCur,m)
                                  * [1/min(12,p_prodLength(possHerds,breeds))]
                                                  $ ( ((p_prodLength(possHerds,breeds) gt 1)
   $$ifi "%farmBranchSows%" == "on"                and  (p_prodLength(possHerds,breeds) gt 2)
                                                      )
   $$ifi "%farmBranchFattners%" == "on"             or ((p_prodLength(possHerds,breeds) le 1) $ (sameas(possHerds,"fattners") and sameas(prodsYearly,"pigMeat")))
                                                     )
                                      * p_OCoeff(possHerds,prodsYearly,breeds,tCur)
                                         * [prods_.m(prodsYearly,tCur,nCur) $ sameas(VQ,"V") + 1 $ sameas(VQ,"Q")])
        /p_resCMAnim(possHerds,"#",tCur,"Q")  ;

   $$ifthen.sows defined newPiglets_
      p_resCMAnim(possHerds,"youngPiglet",tCur,VQ) $ (p_resCMAnim(possHerds,"#",tCur,"Q") $ p_OCoeff(possHerds,"youngPiglet","",tCur))
       = p_resCMAnim(possHerds,"youngPiglet",tCur,VQ)
           + sum( (actHerds(possHerds,"",feedRegime,tCur,m),nCur) $ t_n(tcur,nCur),
                     v_herdSize("sows","",feedRegime,tCur,nCur,m)
                        *p_OCoeff(possHerds,"youngPiglet","",tCur)/card(m)
                                            * [newPiglets_.m(tCur,nCur,m) $ sameas(VQ,"V") + 1 $ sameas(VQ,"Q")])
           /p_resCMAnim(possHerds,"#",tCur,"Q")  ;
   $$endif.sows

   p_resCMAnim(possHerds,"OtherCosts",tCur,VQ) $ p_resCMAnim(possHerds,"#",tCur,"Q")

        = sum( (actHerds(possHerds,breeds,feedRegime,tCur,m),t_n(tCur,nCur)),
                            -v_herdSize(possHerds,breeds,feedRegime,tCur,nCur,m)*p_probn(nCur)

*                        --- (1) effect of monthly resolution, e.g. if yearly = 1/1, if monthly 1/12
                        * [    { 1/card(m)
*                      --- (2) reflect production length
                                  * min(12,p_prodLength(possHerds,breeds))/12 } $ cattle(possHerds)
                             + 1 $ (not cattle(possHerds)) ]
*                      --- cost per year for doing the process one time (e.g. rais one calv) for cows and sows
*                          monthly value for piglets and fattners
                                  * p_vCost(possHerds,breeds,tCur)   )
        /p_resCMAnim(possHerds,"#",tCur,"Q")  ;

    p_resCMAnim(possHerds(sumHerds),"MachineCosts",tCur,VQ) $ p_resCMAnim(possHerds,"#",tCur,"Q")
      =  sum((actHerds(sumHerds,breeds,feedRegime,tCur,m),curMachines(machType),machLifeUnit,nCur) $ (p_prodLength(sumHerds,breeds) $ t_n(tCur,nCur)),
                v_herdSize(sumHerds,breeds,feedRegime,tCur,nCur,m)
                 * [machNeedHerds_.m(machType,machLifeUnit,tCur,nCur) $ sameas(VQ,"V") + 1 $ sameas(VQ,"Q")]
                 * p_machNeed(sumHerds,"plough","normal",machType,machLifeUnit)
                             * 1/min(12,p_prodLength(sumHerds,breeds)))
        /p_resCMAnim(possHerds,"#",tCur,"Q")  ;


    p_resCMAnim(possHerds(sumHerds),"Labour duals",tCur,VQ) $ p_resCMAnim(possHerds,"#",tCur,"Q")
     = sum( (actHerds(possHerds,breeds,feedRegime,tCur,m),t_n(tCur,nCur)),
            p_herdLab(sumHerds,feedRegime,m)*[LabHerdm_.m(tCur,nCur,m) $ sameas(VQ,"V") + 1 $ sameas(VQ,"Q")]
              *v_herdSize(sumHerds,breeds,feedRegime,tCur,nCur,m)    )
        /p_resCMAnim(possHerds,"#",tCur,"Q")  ;

   $$iftheni.reqs defined reqs_
    p_resCMAnim(possHerds,reqs,tCur,VQ) $ p_resCMAnim(possHerds,"#",tCur,"Q")
     = sum( (actHerds(possHerds,breeds,feedRegime,tCur,m),reqsPhase,t_n(tCur,nCur)) $ p_reqsPhaseLengthMonths(possHerds,breeds,"gen"),
                  -v_herdSize(possHerds,breeds,feedRegime,tCur,nCur,m)
                    * p_reqsPhaseMonths(possHerds,breeds,feedRegime,reqsPhase,reqs)
                          * [reqs_.m(possHerds,breeds,feedRegime,tCur,m,reqsPhase,reqs,nCur) $ sameas(VQ,"V") + 1 $ sameas(VQ,"Q")]
                           *(   v_reqsCorr(possHerds,breeds,"Ener") $ (sameas(reqs,"NEL") or sameas(reqs,"ME"))
                              + v_reqsCorr(possHerds,breeds,"Prot") $ (sameas(reqs,"XP")  or sameas(reqs,"nXP"))
                              + v_reqsCorr(possHerds,breeds,"Rest") $ (not (    sameas(reqs,"XP")  or sameas(reqs,"nXP")
                                                                             or sameas(reqs,"NEL") or sameas(reqs,"ME")))
                            ))
        /p_resCMAnim(possHerds,"#",tCur,"Q")  ;

    p_resCMAnim(possHerds,"herdsByFeedRegime",tCur,VQ) $ p_resCMAnim(possHerds,"#",tCur,"Q")
     = sum( (actHerds(possHerds,breeds,feedRegime,tCur,m),nCur) $ (t_n(tCur,nCur)
                 $ sum(reqsPhase $ (not sameas(reqsPhase,"gen")), p_reqsPhaseLengthMonths(possHerds,breeds,reqsPhase))),
                 -v_herdSize(possHerds,breeds,feedRegime,tCur,nCur,m)
                   * [herdsByFeedRegime_.m(possHerds,breeds,feedRegime,tCur,nCur,m) $ sameas(VQ,"V") + 1 $ sameas(VQ,"Q")])
        /p_resCMAnim(possHerds,"#",tCur,"Q")  ;

    p_resCMAnim(possHerds,"exrPast",tCur,VQ) $ p_resCMAnim(possHerds,"#",tCur,"Q")
     = sum( (actHerds(possHerds,breeds,grazRegime,tCur,m),nCur) $ t_n(tCur,nCur),
                v_herdSize(possHerds,breeds,grazRegime,tCur,nCur,m)
                     * [herdExcrPast_.m(possHerds,grazRegime,tCur,nCur,m) $ sameas(VQ,"V") + 1 $ sameas(VQ,"Q")]
                                      * (     1   $ sameas(grazRegime,"fullGraz")
                                            + 0.5 $ sameas(grazRegime,"partGraz")))
        /p_resCMAnim(possHerds,"#",tCur,"Q")  ;

   $$endif.reqs

   $$ifthen.reqPigs_ defined reqPigs_

    p_resCMAnim(possHerds,feedattr,tCur,VQ) $ (p_resCMAnim(possHerds,"#",tCur,"Q")
                                                $ sum( feedRegime, p_feedReqPig%l%(possHerds,feedRegime,feedAttr)))
     = sum( (actHerds(possHerds,breeds,feedRegime,tCur,m),t_n(tCur,nCur))
         $ (p_feedReqPig%l%(possHerds,feedRegime,feedAttr)
                                              $ (not (sameas(possherds,"pigletsBought") or sameas(possherds,"youngSows")
                                                   or sameas(possherds,"youngPiglets")))),
            - v_herdSize(possHerds,breeds,feedRegime,tCur,nCur,m) * p_feedReqPig(possHerds,feedRegime,feedAttr)
                   * [reqPigs_.m(possHerds,feedAttr,feedRegime,tCur,nCur,m) $ sameas(VQ,"V") + 1 $ sameas(VQ,"Q")] )
        /p_resCMAnim(possHerds,"#",tCur,"Q")  ;

   $$endif.reqPigs_

    p_resCMAnim(possHerds,"herdSize",tCur,VQ) $ p_resCMAnim(possHerds,"#",tCur,"Q")
     = sum( (actHerds(possHerds,breeds,feedRegime,tCur,m),nCur) $ t_n(tCur,nCur),
                 -v_herdSize(possHerds,breeds,feedRegime,tCur,nCur,m)
                   * [herdSize_.m(possHerds,breeds,tCur,nCur,m) $ sameas(VQ,"V") + 1 $ sameas(VQ,"Q")])
        /p_resCMAnim(possHerds,"#",tCur,"Q")  ;

    p_resCMAnim(possHerds,"sumHerds",tCur,VQ) $ p_resCMAnim(possHerds,"#",tCur,"Q")
     = sum( (breeds,feedRegime,t_n(tCur,nCur),m) $ actHerds(possHerds,breeds,feedRegime,tCur,m),
              v_herdSize(possHerds,breeds,feedRegime,tCur,nCur,m) $ (p_prodLength(possHerds,breeds) gt 1)

                *  {   [ + sum(sum_herds(sumHerds,possHerds),sumHerds_.m(sumHerds,breeds,feedRegime,tCur,nCur,m))
                         - sum(sameas(possHerds,sumHerds),sumHerds_.m(sumHerds,breeds,feedRegime,tCur,nCur,m))
                       ] $ sameas(VQ,"V") + 1 $ sameas(VQ,"Q")

                      $$iftheni.cows defined avgLactations_
                        - sum(sameas(dCows,possHerds), p_nLactations-p_nLac(dCows))
                           * [avgLactations_.m(breeds,tCur,nCur) $ sameas(VQ,"V") + 1 $ sameas(VQ,"Q")]
                      $$endif.cows
                   }
        )
        /p_resCMAnim(possHerds,"#",tCur,"Q")  ;

    p_resCMAnim(possHerds,"sumHerdsY",tCur,VQ) $ p_resCMAnim(possHerds,"#",tCur,"Q")
     = sum( (breeds,feedRegime,t_n(tCur,nCur),m) $ actHerds(possHerds,breeds,feedRegime,tCur,m),
              v_herdSize(possHerds,breeds,feedRegime,tCur,nCur,m) $ (p_prodLength(possHerds,breeds) gt 1)

                *  [sum(sameas(possHerds,sumHerds),sumHerdsY_.m(sumHerds,breeds,tCur,nCur))
                          $ sameas(VQ,"V") + 1 $ sameas(VQ,"Q")])
        /p_resCMAnim(possHerds,"#",tCur,"Q")  ;

    p_resCMAnim(possHerds(sumHerds),"stables",tCur,VQ) $ p_resCMAnim(possHerds,"#",tCur,"Q")
     = sum((actHerds(sumHerds,breeds,feedRegime,tCur,m),stableTypes,nCur) $ (t_n(tCur,nCur) $ (not sameas(feedRegime,"fullGraz"))),
                -v_herdSize(sumHerds,breeds,feedRegime,tCur,nCur,m)
                         * p_stableNeed(sumHerds,breeds,stableTypes)
                            *  [ (stableNeed1_.m(stableTypes,tCur,nCur) + stableNeed_.m(stableTypes,tCur,nCur,m))
                                   $ sameas(VQ,"V") + 1 $ sameas(VQ,"Q")]
                            )
        /p_resCMAnim(possHerds,"#",tCur,"Q")  ;

    p_resCMAnim(possHerds,"manQuant",tCur,VQ) $ p_resCMAnim(possHerds,"#",tCur,"Q")
     = sum((actHerds(possHerds,breeds,feedRegime,tCur,m),curManChain,nCur)
          $ (t_n(tCur,nCur) $ manChain_herd(curManChain,possHerds) $ p_prodLength(possherds,breeds)),
                v_herdSize(possHerds,breeds,feedRegime,tCur,nCur,m)
                    * p_manQuantMonth(possHerds,curManChain) * ( 1 - 1   $ sameas(feedRegime,"fullGraz")
                                                                   - 0.5 $ sameas(feedRegime,"partGraz"))
                       * [manQuantm_.m(curManChain,tCur,nCur,m) $ sameas(VQ,"V") + 1 $ sameas(VQ,"Q") ])
        /p_resCMAnim(possHerds,"#",tCur,"Q")  ;


    p_resCMAnim(possHerds,allNut,tCur,VQ) $ p_resCMAnim(possHerds,"#",tCur,"Q")
     = sum((actHerds(possHerds,breeds,feedRegime,tCur,m),curManChain,nCur)
          $ (t_n(tCur,nCur) $ manChain_herd(curManChain,possHerds) $ p_prodLength(possherds,breeds)),
               v_herdSize(possHerds,breeds,feedRegime,tCur,nCur,m)

               *[  sum(sameas(nut2,allnut),

                      p_nut2ManMonth(possHerds,feedRegime,nut2)    * ( 1 - 1   $ sameas(feedRegime,"fullGraz")
                                                                         - 0.5 $ sameas(feedRegime,"partGraz"))
                    * sum(herd_stableStyle(possHerds,stableStyles), p_nutShare(curManChain,stableStyles,nut2))
                      * [nut2ManureHerds_.m(possherds,breeds,curManChain,nut2,tCur,nCur,m)$ sameas(VQ,"V") + 1 $ sameas(VQ,"Q")])

   $$iftheni.duev defined nutExcrDuev_
                 + sum((sameas(nut,allNut),nType) $ (    (cattle(possHerds)  and sameas(nType,"cattle"))
                         $$ifi defined pigherds      or (pigHerds(possHerds) and sameas(nType,"pig"))
                                                    ),
                                  ( 1 - 1   $ sameas(feedRegime,"fullGraz")
                                      - 0.5 $ sameas(feedRegime,"partGraz"))
                                 * 1/card(m)   *  p_nutExcreDueV(possHerds,feedRegime,nut)
                                 * [nutExcrDueV_.m(nut,nType,tCur,nCur)$ sameas(VQ,"V") + 1 $ sameas(VQ,"Q")] )
   $$endif.duev
                  ])

        /p_resCMAnim(possHerds,"#",tCur,"Q")  ;

    p_resCMAnim(possHerds,"sumGV",tCur,VQ) $ p_resCMAnim(possHerds,"#",tCur,"Q")
     = sum((actHerds(possHerds,breeds,feedRegime,tCur,m),nCur)
          $ (t_n(tCur,nCur)$ p_prodLength(possherds,breeds)),
                -v_herdSize(possHerds,breeds,feedRegime,tCur,nCur,m)
                    * [sumGV_.m(tCur,nCur)$ sameas(VQ,"V") + 1 $ sameas(VQ,"Q")])
        /p_resCMAnim(possHerds,"#",tCur,"Q")  ;

    p_resCMAnim(possHerds,"branchSize",tCur,VQ) $ p_resCMAnim(possHerds,"#",tCur,"Q")
     = sum( (branches_to_acts(branches,possHerds),breeds,feedRegime,t_n(tCur,nCur),m)
            $ (actHerds(possHerds,breeds,feedRegime,tCur,m) $ p_prodLength(possHerds,breeds)),
                v_herdSize(possHerds,breeds,feedRegime,tCur,nCur,m)
                   * 1/min(12,p_prodLength(possHerds,breeds))
                    * [branchSize_.m(branches,tCur,nCur) $ sameas(VQ,"V") + 1 $ sameas(VQ,"Q")]
                )
        /p_resCMAnim(possHerds,"#",tCur,"Q")  ;

    $$iftheni.defEx not defined exHaustAnim
        set exHaustAnim / otherCosts,machineCosts,"Labour duals",(set.reqs),"herdSize","herdsByFeedRegime",set.prodsYearly,
                          "sumherds","sumHerdsY","exrPast","stables","manQuant",(set.allNut),"sumGV","branchSize" /;
        exHaustAnim(feedAttr) = YES;
    $$endif.defEx

    p_resCMAnim(possHerds,exhaustAnim,tCur,"marg") $ p_resCMAnim(possHerds,exhaustAnim,tCur,"Q")
      = p_resCMAnim(possHerds,exhaustAnim,tCur,"V") / p_resCMAnim(possHerds,exhaustAnim,tCur,"Q");

    p_resCMAnim(possHerds,"test",tCur,"V") $ p_resCMAnim(possHerds,"#",tCur,"Q")
      = sum(exHaustAnim, p_resCMAnim(possHerds,exhaustAnim,tCur,"V"));

    p_resCMAnim(possHerds,"test",tCur,"V") $ ( (abs(p_resCMAnim(possHerds,"test",tCur,"V")) le 0.1) $ p_resCMAnim(possHerds,"#",tCur,"Q")) = 0;
    option p_resCMAnim:2:3:1;
    display p_resCMAnim;

$endif.herd

$iftheni.cattle %cattle%==true
 $$ifi not defined  p_resCMCattle parameter p_resCMCattle(herds,t,cmRows,cmCols)
*          p_test(set_dairy_prods,t,cmRows,cmCols)
;

$$iftheni.dairy %dairyHerd%==true
*
*   --- calculation of prices for gross margin rows
*
p_resCMCattle("cows",tCur,"MilkRevenue","Price") $ p_res(%1,%2,"Milk","SQuant","",tCur)
  = p_res(%1,%2,"Milk","Price","",tCur) / 1000;

p_resCMCattle("cows",tCur,"OldCowRevenue","Price") $ p_res(%1,%2,"oldCow","SQuant","",tCur)
  = p_res(%1,%2,"oldCow","Price","",tCur);

p_resCMCattle("cows",tCur,"CalvRevenue","Price") $ sum(calv_prods, p_res(%1,%2,calv_prods,"SQuant","",tCur))
  = sum(calv_prods $ p_res(%1,%2,calv_prods,"SQuant","",tCur), p_res(%1,%2,calv_prods,"SReve","",tCur)) / sum(calv_prods, p_res(%1,%2,calv_prods,"SQuant","",tCur));

*   --- calculation of amounts for gross margin rows
*
p_resCMCattle("cows",tCur,"MilkRevenue","Amount") $ p_res(%1,%2,"Milk","SQuant","",tCur)
  = sum(breeds, p_res(%1,%2,"cows","milk",breeds,tCur));

p_resCMCattle("cows",tCur,"OldCowRevenue","Amount") $ (p_res(%1,%2,"cows","levl","",tCur) $ p_res(%1,%2,"oldCow","SQuant","",tCur))
  = p_res(%1,%2,"oldCow","SQuant","",tCur) / p_res(%1,%2,"cows","levl","",tCur);

p_resCMCattle("cows",tCur,"CalvRevenue","Amount") $ sum(calv_prods, p_res(%1,%2,calv_prods,"SQuant","",tCur))
  = sum(calv_prods, p_res(%1,%2,calv_prods,"SQuant","",tCur)) / p_res(%1,%2,"cows","levl","",tCur);

*
*   --- calculation of sums / totals for gross margin rows
*
p_resCMCattle("cows",tCur,"OldCowRevenue","Total") $ (p_res(%1,%2,"cows","levl","",tCur) $ p_res(%1,%2,"oldCow","SQuant","",tCur))
   = p_res(%1,%2,"oldCow","SReve","",tCur) / p_res(%1,%2,"cows","levl","",tCur);

p_resCMCattle("cows",tCur,"CalvRevenue","Total") $ (sum(calv_prods, p_res(%1,%2,calv_prods,"SQuant","",tCur)) $ p_res(%1,%2,"cows","levl","",tCur))
  = sum(calv_prods, p_res(%1,%2,calv_prods,"SReve","",tCur)) / p_res(%1,%2,"cows","levl","",tCur);

p_resCMCattle("cows",tCur,"MilkRevenue","Total") $ sum(breeds, p_res(%1,%2,"cows","levl",breeds,tCur))
   = p_res(%1,%2,"Milk","SReve","",tCur) / p_res(%1,%2,"cows","levl","",tCur);

p_resCMCattle("cows",tCur,"Revenues","Total") $ sum(set_dairy_prods, p_res(%1,%2,set_dairy_prods,"SQuant","",tCur))
   = p_resCMCattle("cows",tCur,"MilkRevenue","Total") + p_resCMCattle("cows",tCur,"OldCowRevenue","Total") + p_resCMCattle("cows",tCur,"CalvRevenue","Total");

p_resCMCattle("cows",tCur,"Replacements","Total") $ sum(breeds, p_res(%1,%2,"cows","levl",breeds,tCur))
   = p_res(%1,%2,"cows","remonte","",tCur)
     * sum(breeds $ p_res(%1,%2,"cows","levl",breeds,tCur),
       p_res(%1,%2,"remonte","levl",breeds,tCur) / p_res(%1,%2,"cows","levl",breeds,tCur));

p_resCMCattle("cows",tCur,"Rearing","Total") $ sum(breeds, p_res(%1,%2,"cows","levl",breeds,tCur))
*  Correct rearing costs for inter-cavlving period, and only accoutn first 50days(0.38 of 180) as done by LfL Bayern
   = (p_res(%1,%2,"fCalvsRais","fCost","",tCur) + p_res(%1,%2,"fCalvsRais","fnmCost","",tCur)) * 365/p_calvAttr("HF","daysBetweenBirths") * 0.38;

p_resCMCattle("cows",tCur,"Feed","Total") $ sum(breeds, p_res(%1,%2,"cows","levl",breeds,tCur))
   = p_res(%1,%2,"cows","fCost","",tCur) + p_res(%1,%2,"cows","fnmCost","",tCur);

p_resCMCattle("cows",tCur,"Concentrates","Total") $ sum(breeds, p_res(%1,%2,"cows","levl",breeds,tCur))
   = p_res(%1,%2,"cows","fCost","",tCur);

p_resCMCattle("cows",tCur,"Roughages","Total") $ sum(breeds, p_res(%1,%2,"cows","levl",breeds,tCur))
   = p_res(%1,%2,"cows","fnmCost","",tCur);
*    = sum((cows,feedRegime,reqsPhase,roughages,nCur), p_dailyFeedRes(cows,feedRegime,reqsPhase,roughages)/1000*12
*      * ( -   feeduse_.m(roughages,tCur,nCur)
*             - sum(m,feeduseM_.m(roughages,m,tCur,nCur))));

p_resCMCattle("cows",tCur,"SexingCosts","Total") $ sum(breeds, p_res(%1,%2,"cows","levl",breeds,tCur))
   = sum((t_n(tCur,nCur),breeds,m), v_sexingF.l(breeds,tCur,nCur,m)*p_probn(ncur)  * %costFemaleSexing%
                                  + v_sexingM.l(breeds,tCur,nCur,m)*p_probn(ncur)  * %costFemaleSexing%)
     / sum(breeds, p_res(%1,%2,"cows","levl",breeds,tCur));

p_resCMCattle("cows",tCur,"OtherCosts","Total") $ sum(breeds, p_res(%1,%2,"cows","levl",breeds,tCur))
   = p_res(%1,%2,"cows","vCostO","",tCur)
*   + sum((breeds,t_n(tCur,nCur),m), v_sexingF.l(breeds,tCur,nCur,m) * %costFemaleSexing%
*       + v_sexingF.l(breeds,tCur,nCur,m) * %costFemaleSexing%) / sum(breeds, p_res(%1,%2,"cows","levl",breeds,tCur))
       ;

p_resCMCattle("cows",tCur,"ContributionMargin","Total") $ sum(breeds, p_res(%1,%2,"cows","levl",breeds,tCur))
   =   p_resCMCattle("cows",tCur,"Revenues","Total")
         - p_resCMCattle("cows",tCur,"Replacements","Total")
         - p_resCMCattle("cows",tCur,"Rearing","Total")
         - p_resCMCattle("cows",tCur,"Feed","Total")
         - p_resCMCattle("cows",tCur,"SexingCosts","Total")
         - p_resCMCattle("cows",tCur,"OtherCosts","Total");
*         - p_res(%1,%2,"cows","vCostO","",tCur);

p_resCMCattle("cows",t,"StableFixCosts","Total") $ sum(breeds, p_res(%1,%2,"cows","levl",breeds,t))
* new stables bought
   = [sum( (stables,hor,nCur), v_buyStables.l(stables,hor,t,nCur)*p_priceStables(stables,hor,t))
* insurance and repair costs of stables
   + sum( (stables,hor,nCur) $ v_stableInv.up(stables,hor,t,nCur),
        v_stableInv.l(stables,hor,t,nCur) * p_priceStables(stables,hor,t-1)*p_probn(ncur)
               * (  0.01 $ sameas(hor,"long")
                  + 0.02 $ sameas(hor,"middle")
                  + 0.03 $ sameas(hor,"short") ) )]
   / p_res(%1,%2,"cows","levl","",t)
  ;

*
*  --- Heifers
*
* Opportunity costs for not selling animal
p_resCMCattle("remonte",tCur,"Replacements","Total") $ sum(breeds, p_res(%1,%2,"remonte","levl",breeds,tCur))
   = %fCalv_HF_Price%;

p_resCMCattle("remonte",tCur,"Concentrates","Total") $ sum(breeds, p_res(%1,%2,"remonte","levl",breeds,tCur))
  = p_res(%1,%2,"remonte","fCost","",tCur);

p_resCMCattle("remonte",tCur,"Roughages","Total") $ sum(breeds, p_res(%1,%2,"remonte","levl",breeds,tCur))
= p_res(%1,%2,"remonte","fnmCost","",tCur);

p_resCMCattle("remonte",tCur,"Feed","Total") $ sum(breeds, p_res(%1,%2,"remonte","levl",breeds,tCur))
   = p_res(%1,%2,"remonte","fCost","",tCur) + p_res(%1,%2,"remonte","fnmCost","",tCur);

p_resCMCattle("remonte",tCur,"OtherCosts","Total") $ sum(breeds, p_res(%1,%2,"remonte","levl",breeds,tCur))
  = p_res(%1,%2,"remonte","vCostO","",tCur);

$ontext
p_resCMCattle("cows",tCur,"ContributionMargin","Total") $ sum(breeds, p_res(%1,%2,"cows","levl",breeds,tCur))
   =   p_resCMCattle("cows",tCur,"Revenues","Total")
         - p_resCMCattle("cows",tCur,"Replacements","Total")
         - p_resCMCattle("cows",tCur,"Rearing","Total")
         - p_resCMCattle("cows",tCur,"Feed","Total")
         - p_res(%1,%2,"cows","vCostO","",tCur);
$offtext


$endif.dairy

*
*   --- Bulls
*

$iftheni.beef "%farmBranchBeef%" == "on"
*
*   --- Prices
*
p_resCMCattle("bulls",tCur,"Revenues","Price") $ sum(beef_outputs, p_res(%1,%2,beef_outputs,"SQuant","",tCur))
    = sum((beef_outputs,bullsSold,curBreeds) $ p_res(%1,%2,bullsSold,beef_outputs,curBreeds,tCur),
             p_res(%1,%2,beef_outputs,"Price","",tCur));
*
*   --- Amounts
*
p_resCMCattle("bulls",tCur,"Revenues","Amount") $ sum(beef_outputs, p_res(%1,%2,beef_outputs,"SQuant","",tCur))
    = sum((beef_outputs,bullsSold,curBreeds) $ p_res(%1,%2,bullsSold,beef_outputs,curBreeds,tCur),
             p_res(%1,%2,beef_outputs,"SQuant","",tCur) / p_res(%1,%2,bullsSold,"levl","",tCur));

*
*   --- Revenues
*

p_resCMCattle("bulls",tCur,"Revenues","Total") $ sum(beef_outputs, p_res(%1,%2,beef_outputs,"SQuant","",tCur))
    = sum((beef_outputs,bullsSold,curBreeds) $ p_res(%1,%2,bullsSold,beef_outputs,curBreeds,tCur),
             p_res(%1,%2,beef_outputs,"SReve","",tCur) / p_res(%1,%2,bullsSold,"levl","",tCur));

p_resCMCattle("bulls",tCur,"Replacements","Total") $ sum(beef_outputs, p_res(%1,%2,beef_outputs,"SQuant","",tCur))
    = p_res(%1,%2,"mCalvsRais","reve","",tCur);

p_resCMCattle("bulls",tCur,"Rearing","Total") $ sum(breeds, p_res(%1,%2,"bulls","levl",breeds,tCur))
   = p_res(%1,%2,"mCalvsRais","fCost","",tCur);

p_resCMCattle("bulls",tCur,"Feed","Total") $ sum((breeds,bulls), p_res(%1,%2,bulls,"levl",breeds,tCur))
   = sum(bulls, p_res(%1,%2,bulls,"fCost","",tCur) + p_res(%1,%2,bulls,"fnmCost","",tCur));

p_resCMCattle("bulls",tCur,"Concentrates","Total") $ sum((breeds,bulls), p_res(%1,%2,bulls,"levl",breeds,tCur))
   = sum(bulls, p_res(%1,%2,bulls,"fCost","",tCur));

p_resCMCattle("bulls",tCur,"Roughages","Total") $ sum((breeds,bulls), p_res(%1,%2,bulls,"levl",breeds,tCur))
   = sum(bulls, p_res(%1,%2,bulls,"fnmCost","",tCur));

p_resCMCattle("bulls",tCur,"OtherCosts","Total") $ sum((breeds,bulls), p_res(%1,%2,bulls,"levl",breeds,tCur))
   = sum(bulls, p_res(%1,%2,bulls,"vCostO","",tCur));

p_resCMCattle("bulls",tCur,"ContributionMargin","Total") $ sum((breeds,bulls), p_res(%1,%2,bulls,"levl",breeds,tCur))
   =   p_resCMCattle("bulls",tCur,"Revenues","Total")
         - p_resCMCattle("bulls",tCur,"Replacements","Total")
         - p_resCMCattle("bulls",tCur,"Rearing","Total")
         - p_resCMCattle("bulls",tCur,"Feed","Total")
         - p_res(%1,%2,"bulls","vCostO","",tCur);
$endif.beef

*
*   --- Mother Cows
*
$iftheni.mc "%farmBranchMotherCows%" == "on"
*
*   --- calculation of prices for gross margin rows
*
p_resCMCattle("motherCow",tCur,"OldCowRevenue","Price") $ p_res(%1,%2,"oldCow","SQuant","",tCur)
  = p_res(%1,%2,"oldCow","Price","",tCur);

p_resCMCattle("motherCow",tCur,"CalvRevenue","Price") $ sum(calv_prods, p_res(%1,%2,calv_prods,"SQuant","",tCur))
  = sum(calv_prods $ p_res(%1,%2,calv_prods,"SQuant","",tCur), p_res(%1,%2,calv_prods,"SReve","",tCur)) / sum(calv_prods, p_res(%1,%2,calv_prods,"SQuant","",tCur));

*   --- calculation of amounts for gross margin rows
*

p_resCMCattle("motherCow",tCur,"OldCowRevenue","Amount") $ (p_res(%1,%2,"motherCow","levl","",tCur) $ p_res(%1,%2,"oldCow","SQuant","",tCur))
  = p_res(%1,%2,"oldCow","SQuant","",tCur) / p_res(%1,%2,"motherCow","levl","",tCur);

p_resCMCattle("motherCow",tCur,"CalvRevenue","Amount") $ (p_res(%1,%2,"motherCow","levl","",tCur) $ sum(calv_prods, p_res(%1,%2,calv_prods,"SQuant","",tCur)))
  = sum(calv_prods, p_res(%1,%2,calv_prods,"SQuant","",tCur))/ p_res(%1,%2,"motherCow","levl","",tCur);

*
*   --- calculation of sums / totals for gross margin rows
*
p_resCMCattle("motherCow",tCur,"OldCowRevenue","Total") $ (p_res(%1,%2,"motherCow","levl","",tCur) $ p_res(%1,%2,"oldCow","SQuant","",tCur))
   = p_res(%1,%2,"oldCow","SReve","",tCur) / p_res(%1,%2,"motherCow","levl","",tCur);

p_resCMCattle("motherCow",tCur,"CalvRevenue","Total") $ (sum(calv_prods, p_res(%1,%2,calv_prods,"SQuant","",tCur)) $ p_res(%1,%2,"motherCow","levl","",tCur))
  = sum(calv_prods, p_res(%1,%2,calv_prods,"SReve","",tCur)) / p_res(%1,%2,"motherCow","levl","",tCur);

p_resCMCattle("motherCow",tCur,"Revenues","Total") $ sum(set_dairy_prods, p_res(%1,%2,set_dairy_prods,"SQuant","",tCur))
   = p_resCMCattle("motherCow",tCur,"MilkRevenue","Total") + p_resCMCattle("motherCow",tCur,"OldCowRevenue","Total") + p_resCMCattle("motherCow",tCur,"CalvRevenue","Total");

p_resCMCattle("motherCow",tCur,"Replacements","Total") $ sum(breeds, p_res(%1,%2,"motherCow","levl",breeds,tCur))
   = p_res(%1,%2,"motherCow","remonte","",tCur);

p_resCMCattle("motherCow",tCur,"Rearing","Total") $ sum(breeds, p_res(%1,%2,"motherCow","levl",breeds,tCur))
   = p_res(%1,%2,"fCalvsRais","fCost","",tCur);

p_resCMCattle("motherCow",tCur,"Feed","Total") $ sum(breeds, p_res(%1,%2,"motherCow","levl",breeds,tCur))
   = p_res(%1,%2,"motherCow","fCost","",tCur) + p_res(%1,%2,"motherCow","fnmCost","",tCur);

p_resCMCattle("motherCow",tCur,"Concentrates","Total") $ sum(breeds, p_res(%1,%2,"motherCow","levl",breeds,tCur))
   = p_res(%1,%2,"motherCow","fCost","",tCur);

p_resCMCattle("motherCow",tCur,"Roughages","Total") $ sum(breeds, p_res(%1,%2,"motherCow","levl",breeds,tCur))
   = p_res(%1,%2,"motherCow","fnmCost","",tCur);

p_resCMCattle("motherCow",tCur,"OtherCosts","Total") $ sum(breeds, p_res(%1,%2,"motherCow","levl",breeds,tCur))
   = p_res(%1,%2,"motherCow","vCostO","",tCur);

p_resCMCattle("motherCow",tCur,"ContributionMargin","Total") $ sum(breeds, p_res(%1,%2,"motherCow","levl",breeds,tCur))
   =   p_resCMCattle("motherCow",tCur,"Revenues","Total")
         - p_resCMCattle("motherCow",tCur,"Replacements","Total")
         - p_resCMCattle("motherCow",tCur,"Rearing","Total")
         - p_resCMCattle("motherCow",tCur,"Feed","Total")
         - p_res(%1,%2,"motherCow","vCostO","",tCur);
$endif.mc


option p_resCMCattle:2:1:1;
display p_resCMCattle;
$endif.cattle

*
*   --- Pigs
*


*
*   --- Sows
*

*set gMentriesPigs /revenues,directCosts,seeding,fertilizer,PSM,insurance,machineCosts,directCostFreeRev,grossMargin/;
*parameter p_resContributionMarginFatteners, p_resContributionMarginSows;
