********************************************************************************
$ontext

   Dairdyn project

   GAMS file : GEN_SUMRES.GMS

   @purpose  : Generate summary results
   @author   : W.Britz, copy code from main to include
   @date     : 27.01.18
   @since    :
   @refDoc   :
   @seeAlso  :
   @calledBy :

$offtext
********************************************************************************

  p_sumRes(%1,%2,"stableYear")         =   %stableYear%;
  p_sumRes(%1,%2,"Profit")             =   sum(nCur, v_objeN.l(nCur)*p_probn(nCur));
  p_sumRes(%1,%2,"obje")               =   p_res(%1,%2,"objval","sum","","mean");
  p_sumRes(%1,%2,"netCashFlow")        =   p_res(%1,%2,"netCashFlow","sum","","mean");
  p_sumRes(%1,%2,landType)             =   p_res(%1,%2,"cropped",landType,"","mean");
  p_sumRes(%1,%2,curCrops)             =   p_res(%1,%2,curCrops,"levl","","mean");
  p_sumRes(%1,%2,"totalLabour")        =   sum (tCur, p_res(%1,%2,"onFarm","hours","",tCur)) /p_cardtCur;
  p_sumRes(%1,%2,"hiredLabour")        =   sum (tcur, p_res(%1,%2,"hiredLabour","hours","",tCur))/p_cardtCur;
  p_sumRes(%1,%2,"totalLabouroffFarm") =   sum (t_n(tCur,nCur),v_labOffTot.l(tCur,nCur)*p_probN(nCur) )           /p_cardtCur + eps;
*  p_sumRes(allWorktype)          =   sum (t_n(tCur,nCur), p_res(%1,"base",%1,allWorkType,"wage","",tCur))/p_cardtCur ;

  p_sumRes(%1,%2,"NSurplus")           =   p_res(%1,%2,"NSurplus","Quant","","mean") ;
  p_sumRes(%1,%2,"PSurplus")           =   p_res(%1,%2,"PSurplus","Quant","","mean") ;

$ifi defined p_cropIns     p_sumRes(%1,%2,"cropInsCost")   = sum((sys,t_n(t,nCur)),      v_buyCost("cropIns",sys,t,nCur)*p_probN(nCur));
$ifi defined p_cropIns     p_sumRes(%1,%2,"cropInsHa")     = sum((curCrops,sys,t),       v_buyCropIns(curCrops,sys,t));
$ifi defined p_cropIns     p_sumRes(%1,%2,cropsIns)        = sum((cropsIns_crops(cropsIns,curCrops),sys,t),v_buyCropIns(curCrops,sys,t));


$iftheni.duev %duev% == true
$iftheni.ma %manure% == true

*  p_sumRes(%1,%2,"NorgAppl")           =  p_res(%1,%2,"NOrganicApplied","Quant","","mean") ;

       $$iftheni.ExMan %AllowManureExport%==true
       p_sumRes(%1,%2,"ManExpVol")     =   p_res(%1,%2,"manExportVol","Quant","","mean")  ;
       $$endif.ExMan

       $$iftheni.ImMan %AllowManureImport%==true
       p_sumRes(%1,%2,"ManImpVol")     =     p_res(%1,%2,"manImortVol","Quant","","mean")  ;
       $$endif.ImMan

$endif.ma
$endif.duev


* --- Calculation of share of used labour from total annual available labour

  p_sumRes(%1,%2,"labourUseOnFarm%")          =  sum(tCur, p_res(%1,%2,"onFarm","hours","",tCur) / p_yearlyLabH(tCur)  ) /p_cardtCur * 100;
  p_sumRes(%1,%2,"labourUseOffFarm%")         =  sum(tCur, p_res(%1,%2,"offFarm","hours","",tCur) / p_yearlyLabH(tCur)  ) /p_cardtCur * 100;
  p_sumRes(%1,%2,"labourUse%")                =  sum(tCur, (p_res(%1,%2,"onFarm","hours","",tCur)+p_res(%1,%2,"offFarm","hours","",tCur))/ p_yearlyLabH(tCur)  ) /p_cardtCur * 100;

* --- Calcluation of number of months when available labour becomes binding

 p_numbOfBindLabourMonths(tCur,m) = sum( nCur $ (v_labTotM.up(tCur,nCur,m) - v_labTotM.l(tCur,nCur,m) lt 10), p_probn(nCur));

  p_sumRes(%1,%2,"labourBoundMonthly") =    sum( (tCur,m), p_numbOfBindLabourMonths(tCur,m) )/p_cardtCur;

* --- Calculation of (1) number of animal in herd and (2) annual deviation from mean number of animals to see irregularities in herd distribution

$iftheni.dh %dairyHerd% == true
  p_sumRes(%1,%2,"cows")              = p_res(%1,%2,"cows","levl"," ","mean")  ;
  p_sumRes(%1,%2,"DeviationMeanCows") = sum (tCur, abs (p_res(%1,%2,"cows","levl"," ",tCur) - p_res(%1,%2,"cows","levl"," ","mean")  )  ) / p_cardtCur;
  p_sumRes(%1,%2,"stockingDensity")   = sum((t_n(tCur,nCur)), v_sumGV(tCur,nCur))  / (p_nArabLand + p_nGrasLand +  p_nPastLand ) / p_cardtCur;   

$endif.dh

$iftheni.dh "%farmBranchMotherCows%"    == "on"
  p_sumRes(%1,%2,"motherCow") = p_res(%1,%2,"motherCow","levl"," ","mean")  ;
  p_sumRes(%1,%2,"DeviationMeanMC")                          = sum (tCur, abs (p_res(%1,%2,"MotherCow","levl"," ",tCur) - p_res(%1,%2,"cows","levl"," ","mean")  )  ) / p_cardtCur;
$endif.dh

$iftheni.dh "%farmBranchBeef%"    == "on"
  p_sumRes(%1,%2,possherds) $ sameas (possherds,"bulls")    = p_res(%1,%2,possHerds,"levl"," ","mean")  ;
  p_sumRes(%1,%2,possherds) $ sameas (possherds,"mCalvsRais")    = p_res(%1,%2,possHerds,"levl"," ","mean")  ;
  p_sumRes(%1,%2,"DeviationMeanBulls")                      = sum (tCur, abs (p_res(%1,%2,"bulls","levl"," ",tCur) - p_res(%1,%2,"cows","levl"," ","mean")  )  ) / p_cardtCur;
$endif.dh

$iftheni.fat "%farmBranchfattners%"    == "on"
  p_sumRes(%1,%2,possherds) $ sameas (possherds,"fattners") = p_res(%1,%2,possHerds,"levl"," ","mean")  ;
  p_sumRes(%1,%2,"DeviationMeanFattners")                       = sum (tCur, abs (p_res(%1,%2,"fattners","levl"," ",tCur) - p_res(%1,%2,"fattners","levl"," ","mean")  )  ) / p_cardtCur;
$endif.fat

$iftheni.sows "%farmBranchSows%"    == "on"
  p_sumRes(%1,%2,possherds) $ sameas (possherds,"sows") = p_res(%1,%2,possHerds,"levl"," ","mean")  ;
  p_sumRes(%1,%2,"DeviationMeanSows")                       = sum (tCur, abs (p_res(%1,%2,"sows","levl"," ",tCur) - p_res(%1,%2,"sows","levl"," ","mean")   )  ) / p_cardtCur;
$endif.sows

$iftheni.biogas %biogas% == true
  p_sumRes(%1,%2,curBhkw)        = sum(curEeg, p_res(%1,%2,curBhkw,curEeg,"","mean")) ;
  p_sumRes(%1,%2,curEEg)         = sum(curBhkw, p_res(%1,%2,curBhkw,curEeg,"","mean")) ;

* --- Use of availabe capacity
  p_sumRes(%1,%2,"capacityUseBiogas")  $ sum( (curBhkw,eeg,tCur,nCur,m),v_useBioGasPlant.l(curBhkw,eeg,tCur,nCur) )
                           = sum( ( curBhkw,eeg,tCur,nCur,m), v_totVolFermMonthly.l(curBhkw,eeg,tCur,nCur,m))
                                            /   sum( (curBhkw,eeg,tCur,nCur,m),v_useBioGasPlant.l(curBhkw,eeg,tCur,nCur)  *  p_volFermMonthly(curBhkw) )     ;
* --- Share of crops in fermenter
  p_sumRes(%1,%2,"shareCropsBiogas") $ sum((curBhkw,eeg,tCur,nCur,m), v_totVolFermMonthly.l(curBhkw,eeg,tCur,nCur,m))
                                 = sum( (bhkw,eeg,crM(biogasFeedM),tCur,nCur,m), v_usedCropBiogas.l(bhkw,eeg,crM,tCur,nCur,m) )
                                                 /   sum( (curBhkw,eeg,tCur,nCur,m), v_totVolFermMonthly.l(curBhkw,eeg,tCur,nCur,m))  ;
* --- produced electricity
  p_sumRes(%1,%2,"Biogas produced electricity") $ sum((curBhkw,eeg,tCur,nCur,m), v_totVolFermMonthly.l(curBhkw,eeg,tCur,nCur,m))
                                 = sum( (curBhkw,eeg,tCur,nCur,m), v_prodElec.l(curBhkw,eeg,tCur,nCur,m) );



* --- On-Farm Biogas inputs
   p_sumRes(%1,%2,"Crop based on-farm Biogas inputs in t") $ sum((curBhkw,eeg,tCur,nCur,m), v_totVolFermMonthly.l(curBhkw,eeg,tCur,nCur,m))
                                 = sum( (curBhkw,eeg,crM(biogasFeedM),tCur,nCur,m),  v_feedBioGas.l(curBhkw,eeg,biogasFeedM,tCur,nCUr,m) );

   p_sumRes(%1,%2,"Crop based off-farm Biogas inputs in t") $ sum((curBhkw,eeg,tCur,nCur,m), v_totVolFermMonthly.l(curBhkw,eeg,tCur,nCur,m))
                                 = sum( (curBhkw,eeg,crM(biogasFeedM),tCur,nCur,m),    v_purchCrop.l(curBhkw,eeg,biogasFeedM,tCur,nCUr,m) );

   p_sumRes(%1,%2,"Manure based off-farm Biogas inputs in t") $ sum((curBhkw,eeg,tCur,nCur,m), v_totVolFermMonthly.l(curBhkw,eeg,tCur,nCur,m))
                                 = sum( (curBhkw,eeg,maM,tCur,nCur,m),  v_purchManure.l(curBhkw,eeg,maM,tCur,nCUr,m) );


   p_sumRes(%1,%2,"Digestate volume from crops in t") $ sum((curBhkw,eeg,tCur,nCur,m), v_totVolFermMonthly.l(curBhkw,eeg,tCur,nCur,m))
                                 = sum( (crm(biogasFeedM),tCur,nCur,m),  v_volDigCrop.l(biogasFeedM,tCur,nCUr,m) );


   p_sumRes(%1,%2,"Digestate volume from manure in t") $ sum((curBhkw,eeg,tCur,nCur,m), v_totVolFermMonthly.l(curBhkw,eeg,tCur,nCur,m))
                                 = sum( (tCur,nCur,m),  v_volDigMan.l(tCur,nCUr,m) );



$endif.biogas

$iftheni.iScen not "%useSensLand%"=="true"

  p_sumRes(%1,%2,"margArab") $ sum( (plot,sys,t_n(tCur,nCur)) $ plot_landType(plot,"arab"), v_croppedPlotLand.l(plot,sys,tCur,nCur)*p_probN(nCur))
   =  sum( (plot,t_n(tCur,nCur)) $ plot_landType(plot,"arab"), totPlotLand_.m(plot,tCur,nCur)*v_totPlotLand.l(plot,tCur,nCur))
     /sum( (plot,t_n(tCur,nCur)) $ plot_landType(plot,"arab"),                                v_totPlotLand.l(plot,tCur,nCur)*p_probN(nCur));


$iftheni.dh %cattle%==true

  p_sumRes(%1,%2,"margGras") $ sum( (plot,t_n(tCur,nCur)) $ plot_landType(plot,"gras"), v_totPlotLand.l(plot,tCur,nCur)*p_probN(nCur))
   =  sum( (plot,t_n(tCur,nCur)) $ plot_landType(plot,"gras"), totPlotLand_.m(plot,tCur,nCur)*v_totPlotLand.l(plot,tCur,nCur))
     /sum( (plot,t_n(tCur,nCur)) $ plot_landType(plot,"gras"),                                v_totPlotLand.l(plot,tCur,nCur)*p_probN(nCur))

    + sum(t_n(tCur,nCur), fixGrasLand_.m(tCur,nCur)*p_probN(nCur))/card(tCur);

$else.dh

    p_sumRes(%1,%2,"margGras") = 0;


$endif.dh

$endif.iscen
  $$ifi not defined dummyMarg set dummyMarg / margArab,margGras /;

  p_sumRes(%1,%2,"margLab") $ sum( (t_n(tCur,nCur),m), v_labTotM.l(tCur,nCur,m))
                                           =  sum( t_n(tCur,nCur), sum(m,-labTotM_.m(tCur,nCur,m) * v_LabTotM.l(tCur,nCur,m))
                                                                             + v_offFarmWages.l(tCur,nCur) *p_probN(nCur) )
                       / sum( (t_n(tCur,nCur),m), v_labTotM.l(tCur,nCur,m)* p_probN(nCur));

  p_sumRes(%1,%2,"margLabSum") =  sum( t_n(tCur,nCur),sum(m,-labTotM_.m(tCur,nCur,m) * v_LabTotM.l(tCur,nCur,m))
                                                                              + v_offFarmWages.l(tCur,nCur) *p_probN(nCur) )/card(tCur);

  p_sumRes(%1,%2,"margSum")  =   sum( (plot,t_n(tCur,nCur)),
                                 (  p_sumRes(%1,%2,"margArab") $ plot_landType(plot,"arab")
                                  + p_sumRes(%1,%2,"margGras") $ plot_landType(plot,"gras"))
                                *v_totPlotLand.l(plot,tCur,nCur)*p_probN(nCur))/card(tCur) + p_sumRes(%1,%2,"margLabSum")+1;

  p_sumRes(%1,%2,"margErr")  =   (p_sumRes(%1,%2,"obje") - p_sumRes(%1,%2,"margSum"))/(p_sumRes(%1,%2,"margSum") - p_sumRes(%1,%2,"margLabSum"));

  p_sumRes(%1,%2,"margArab") = p_sumRes(%1,%2,"margArab") * (1+p_sumRes(%1,%2,"margErr"));
  p_sumRes(%1,%2,"margGras") = p_sumRes(%1,%2,"margGras") * (1+p_sumRes(%1,%2,"margErr"));

  p_sumRes(%1,%2,"margLandSum")
     =   sum( (plot,sys,t_n(tCur,nCur)), (  p_sumRes(%1,%2,"margArab") $ plot_landType(plot,"arab")
                                                               + p_sumRes(%1,%2,"margGras") $ plot_landType(plot,"gras"))
                                     * v_croppedPlotLand.l(plot,sys,tCur,nCur)*p_probN(nCur))/card(tCur);

  p_sumRes(%1,%2,"margLand") $ p_sumRes(%1,%2,"margLandSum")
   =   p_sumRes(%1,%2,"margLandSum") / [  sum( (plot,sys,t_n(tCur,nCur)),v_croppedPlotLand.l(plot,sys,tCur,nCur)*p_probN(nCur))/card(tCur)];

  p_sumRes(%1,%2,"margErr") = 0;
  p_sumRes(%1,%2,"margSum") = 0;



 p_res(%1,%2,"margArab","sum","","mean") = p_sumRes(%1,%2,"margArab");
 p_res(%1,%2,"margGras","sum","","mean") = p_sumRes(%1,%2,"margGras");
 p_res(%1,%2,"margLand","sum","","mean") = p_sumRes(%1,%2,"margLand");

* --- Definition of summary parameter for Transform2Bio project focussing on biomass and agri-environment



 p_sumResT2B(%1,"profit")       =   round ( p_res(%1,%2,"objval","sum","","mean")  ,0 );
 p_sumResT2B(%1,landType)       =   round ( p_res(%1,%2,"cropped",landType,"","mean")  ,0 );
 p_sumResT2B(%1,curCrops)       =   round (p_res(%1,%2,curCrops,"levl","","mean")  ,0 );
 p_sumResT2B(%1,"totalLabour")  =   round ( sum (tCur, p_res(%1,%2,"onFarm","hours","",tCur)) /p_cardtCur ,0 );
$ifi "%agriEnvSchemes%" == "true" p_sumResT2B(%1,"AESpayment")   =   round ( sum (t_n(tCur,nCur), v_aesPrem.l (tCur,nCur) ) /p_cardtCur   ,0  ) ;
*$ifi "%envacc%"=="true" p_sumResT2B(%1,bioMassUnit)  =   round ( sum (t_n(tCur,nCur), v_bioMassOutput.l(bioMassUnit,tCur,nCur)) /p_cardTcur ,0 ) ;

$iftheni.dh %dairyHerd% == true
   p_sumResT2B(%1,"cows") = round ( p_res(%1,%2,"cows","levl"," ","mean") , 0);
$endif.dh

$iftheni.b "%farmBranchBeef%"    == "on"
    p_sumResT2B(%1,possherds) $ sameas (possherds,"bulls")    = round ( p_res(%1,%2,possHerds,"levl"," ","mean") , 0)  ;
$endif.b

$iftheni.in not "%intensOptions%"  == "false"
 p_sumResT2B(%1,intens) =  round ( sum( (c_p_t_i(arabcrops,plot,till,intens), t_n(tCur,nCur) )  $ (not catchcrops(arabcrops)),
     v_cropHa.l(arabCrops,plot,till,intens,tCur,nCur) )  /      p_sumRes(%1,%2,"arab")      / p_cardTcur      ,2 )  ;
$endif.in

$iftheni.tech "%additionalTechFile%"  == "tech_GreenRelease"

     $ifi not defined p_pestLoadRes Parameter p_pestLoadRes(*,crops,*,*) ;

     p_pestLoadRes(%1,curcrops,pestProd,pesticideIndi) $ ( (not sameas(curcrops,"idle"))
                      $ ( not sameas(curcrops,"CCclover")) )
                                      = sum(  (t_n(tCur,nCur)) ,
                                             v_pesticideLoad.l(curcrops,pestProd,pesticideIndi,tCur,nCur)  /
                                                    sum (  (c_p_t_i(curcrops,plot,till,intens)) ,
                                                          v_cropha.l(curcrops,plot,till,intens,tCur,ncur)  ) )
                                                              / p_cardTcur  ;

    p_pestLoadRes(%1,curcrops,pestProd,"L") $ ( (not sameas(curcrops,"idle"))
                     $ ( not sameas(curcrops,"CCclover")) )
                                     = sum(  (t_n(tCur,nCur),pesticideIndi) ,
                                              v_pesticideLoad.l(curcrops,pestProd,pesticideIndi,tCur,nCur)  /
                                                    sum (  (c_p_t_i(curcrops,plot,till,intens)) ,
                                                         v_cropha.l(curcrops,plot,till,intens,tCur,ncur)  ) )
                                                            / p_cardTcur  ;

  p_pestLoadRes(%1,curcrops,"SumCrops",pesticideIndi) $ ( (not sameas(curcrops,"idle"))
                                 $ ( not sameas(curcrops,"CCclover")) )
                                               = sum(  (t_n(tCur,nCur),pestProd) ,
                                                        v_pesticideLoad.l(curcrops,pestProd,pesticideIndi,tCur,nCur)  /
                                                                sum (  (c_p_t_i(curcrops,plot,till,intens)) ,
                                                                     v_cropha.l(curcrops,plot,till,intens,tCur,ncur)  ) )
                                                                             / p_cardTcur  ;

   p_pestLoadRes(%1,curcrops,"SumCrops","L") $ ( (not sameas(curcrops,"idle"))
                                 $ ( not sameas(curcrops,"CCclover")) )
                                        = sum(  (t_n(tCur,nCur),pestProd,pesticideIndi) ,
                                                 v_pesticideLoad.l(curcrops,pestProd,pesticideIndi,tCur,nCur)  /
                                                           sum (  (c_p_t_i(curcrops,plot,till,intens)) ,
                                                                    v_cropha.l(curcrops,plot,till,intens,tCur,ncur)  ) )
                                                                       / p_cardTcur  ;



    p_sumResT2B(%1,"GR_Potatoes") $ ( sum ( (t_n(tCur,nCur),c_p_t_i(%1,"potatoes",plot,"GreenR",intens)),
                                      v_cropHa.l(%1,"potatoes","plot1","GreenR",intens,tCur,nCur)  ) ge 0.001  ) = 2 ;

    p_sumResT2B(%1,"GR_Potatoes") $ ( sum ( (t_n(tCur,nCur),c_p_t_i(%1,"potatoes",plot,"GreenR",intens)),
                                      v_cropHa.l(%1,"potatoes","plot1","GreenR",intens,tCur,nCur)  ) le 0.001  ) = 1 ;

    p_sumResT2B(%1,"GR_SugarBeet") $ ( sum ( (t_n(tCur,nCur),c_p_t_i(%1,"SugarBeet",plot,"GreenR",intens)),
                                        v_cropHa.l(%1,"SugarBeet","plot1","GreenR",intens,tCur,nCur)  ) ge 0.001  ) = 2 ;

    p_sumResT2B(%1,"GR_SugarBeet") $ ( sum ( (t_n(tCur,nCur),c_p_t_i(%1,"SugarBeet",plot,"GreenR",intens)),
                                          v_cropHa.l(%1,"Sugarbeet","plot1","GreenR",intens,tCur,nCur)  ) le 0.001  ) = 1 ;

    p_sumResT2B(%1,"GR_winterWheat") $ ( sum ( (t_n(tCur,nCur),c_p_t_i(%1,"winterWheat",plot,"GreenR",intens)),
                                          v_cropHa.l(%1,"winterWheat","plot1","GreenR",intens,tCur,nCur)  ) ge 0.001  ) = 2 ;

    p_sumResT2B(%1,"GR_winterWheat") $ ( sum ( (t_n(tCur,nCur),c_p_t_i(%1,"winterWheat",plot,"GreenR",intens)),
                                         v_cropHa.l(%1,"winterWheat","plot1","GreenR",intens,tCur,nCur)  ) le 0.001  ) = 1 ;

    p_sumResT2B(%1,"GR_winterBarley") $ ( sum ( (t_n(tCur,nCur),c_p_t_i(%1,"winterBarley",plot,"GreenR",intens)),
                                          v_cropHa.l(%1,"winterBarley","plot1","GreenR",intens,tCur,nCur)  ) ge 0.001  ) = 2 ;

    p_sumResT2B(%1,"GR_winterBarley") $ ( sum ( (t_n(tCur,nCur),c_p_t_i(%1,"winterBarley",plot,"GreenR",intens)),
                                          v_cropHa.l(%1,"winterBarley","plot1","GreenR",intens,tCur,nCur)  ) le 0.001  ) = 1 ;

    p_sumResT2B(%1,"GR_price")        =  p_GreenReleasePrice ;
    p_sumResT2B(%1,"GR_efficiency")   =  p_GreenReleaseEff  ;

    p_sumResT2B(%1,"GR_VC_arable")    =   round (  sum ( t_n(tCur,nCur), v_varCost.l(tCur,nCur) + v_varCostActs.l(tCur,nCur) + v_varCostMach.l(tCur,nCur) ) / p_cardTcur  , 2);
    p_sumResT2B(%1,"GR_VC_pesticide") =   round (  sum (   (t_n(tCur,nCur),sys), v_buyCost.l(%1,"herb",sys,tCur,ncur) + v_buyCost.l("Fung",sys,tCur,ncur)  + v_buyCost.l("Insect",sys,tCur,ncur) ) , 2) ;
    p_sumResT2B(%1,"GR_VC_diesel")    =   round (  sum (   (t_n(tCur,nCur),sys), v_buyCost.l(%1,"Diesel",sys,tCur,ncur) ) / p_cardTcur, 2) ;

    $ifi not defined set_sum_pesti set set_sum_pesti(inputs) /fung,herb,insect/ ;

     p_sumResT2B(%1,"GR_VC_pot_pest")  = round ( sum( ( t_n(tCur,nCur),c_p_t_i(%1,"potatoes",plot,till,intens),set_sum_pesti(inputs) ) $ p_costQuant("potatoes",till,intens,inputs),
                                                  v_cropHa.l(%1,"potatoes",plot,till,intens,tCur,nCur) * p_costQuant("potatoes",till,intens,inputs) * v_costQuant("potatoes",inputs)  )
                                                              /     p_sumResT2B(%1,"potatoes") / p_cardTcur  , 2)   ;

   p_sumResT2B(%1,"GR_VC_pot_fung")  = round ( sum( ( t_n(tCur,nCur),c_p_t_i(%1,"potatoes",plot,till,intens) ) $ p_costQuant("potatoes",till,intens,"fung"),
                                                  v_cropHa.l(%1,"potatoes",plot,till,intens,tCur,nCur) * p_costQuant("potatoes",till,intens,"fung") * v_costQuant("potatoes","fung")  )
                                                                    /     p_sumResT2B(%1,"potatoes") / p_cardTcur , 2)   ;

     p_sumResT2B(%1,"GR_pot_pass")    =  round (  sum(    (t_n(tCur,nCur),c_p_t_i(%1,"potatoes",plot,till,intens),labperiod)  , p_crop_op_per_till("potatoes","Herb",labPeriod,till,intens)
                                                                          *      v_cropHa.l(%1,"potatoes",plot,till,intens,tCur,nCur)     )
                                                                                        /     p_sumResT2B(%1,"potatoes") / p_cardTcur , 2)    ;

     p_sumResT2B(%1,"GR_VC_sb_pest")  = round ( sum( ( t_n(tCur,nCur),c_p_t_i(%1,"sugarbeet",plot,till,intens),set_sum_pesti(inputs) ) $ p_costQuant("sugarbeet",till,intens,inputs),
                                                                           v_cropHa.l(%1,"sugarbeet",plot,till,intens,tCur,nCur) * p_costQuant("sugarbeet",till,intens,inputs) * v_costQuant("sugarbeet",inputs)  )
                                                                                   /     p_sumResT2B(%1,"sugarbeet") / p_cardTcur  , 2)   ;

*     p_sumResT2B(%1,"GR_VC_sb_fung")  = round ( sum( ( t_n(tCur,nCur),c_p_t_i(%1,"sugarbeet",plot,till,intens) ) $ p_costQuant("sugarbeet",till,intens,"fung"),
*                                                                          v_cropHa.l(%1,"sugarbeet",plot,till,intens,tCur,nCur) * p_costQuant("sugarbeet",till,intens,"fung") * v_costQuant("sugarbeet","fung")  )
*                                                                               /     p_sumResT2B(%1,"sugarbeet") / p_cardTcur , 2)   ;

     p_sumResT2B(%1,"GR_sb_pass")    =  round (  sum(    (t_n(tCur,nCur),c_p_t_i(%1,"sugarbeet",plot,till,intens),labperiod)  , p_crop_op_per_till("sugarbeet","Herb",labPeriod,till,intens)
                                                                       *      v_cropHa.l(%1,"sugarbeet",plot,till,intens,tCur,nCur)     )
                                                                             /     p_sumResT2B(%1,"sugarbeet") / p_cardTcur , 2)    ;

     p_sumResT2B(%1,"GR_VC_WW_pest")  = round ( sum( ( t_n(tCur,nCur),c_p_t_i(%1,"winterWheat",plot,till,intens),set_sum_pesti(inputs) ) $ p_costQuant("winterWheat",till,intens,inputs),
                                               v_cropHa.l(%1,"winterWheat",plot,till,intens,tCur,nCur) * p_costQuant("winterWheat",till,intens,inputs) * v_costQuant("winterWheat",inputs)  )
                                                         /     p_sumResT2B(%1,"winterWheat") / p_cardTcur  , 2)   ;

*   p_sumResT2B(%1,"GR_VC_WW_fung")  = round ( sum( ( t_n(tCur,nCur),c_p_t_i(%1,"winterWheat",plot,till,intens) ) $ p_costQuant("winterWheat",till,intens,"fung"),
*                                               v_cropHa.l(%1,"winterWheat",plot,till,intens,tCur,nCur) * p_costQuant("winterWheat",till,intens,"fung") * v_costQuant("winterWheat","fung")  )
*                                                        /     p_sumResT2B(%1,"winterWheat") / p_cardTcur , 2)   ;

     p_sumResT2B(%1,"GR_WW_pass")    =  round (  sum(    (t_n(tCur,nCur),c_p_t_i(%1,"winterWheat",plot,till,intens),labperiod)  , p_crop_op_per_till("winterWheat","Herb",labPeriod,till,intens)
                                                 *      v_cropHa.l(%1,"winterWheat",plot,till,intens,tCur,nCur)     )
                                                        /     p_sumResT2B(%1,"winterWheat") / p_cardTcur , 2)    ;

     p_sumResT2B(%1,"GR_VC_WB_pest")  = round ( sum( ( t_n(tCur,nCur),c_p_t_i(%1,"winterBarley",plot,till,intens),set_sum_pesti(inputs) ) $ p_costQuant("winterBarley",till,intens,inputs),
                                                 v_cropHa.l(%1,"winterBarley",plot,till,intens,tCur,nCur) * p_costQuant("winterBarley",till,intens,inputs) * v_costQuant("winterBarley",inputs)  )
                                                       /     p_sumResT2B(%1,"winterBarley") / p_cardTcur  , 2)   ;

*     p_sumResT2B(%1,"GR_VC_WB_fung")  = round ( sum( ( t_n(tCur,nCur),c_p_t_i(%1,"winterBarley",plot,till,intens) ) $ p_costQuant("winterBarley",till,intens,"fung"),
*                                                 v_cropHa.l(%1,"winterBarley",plot,till,intens,tCur,nCur) * p_costQuant("winterBarley",till,intens,"fung") * v_costQuant("winterBarley","fung")  )
*                                                     /     p_sumResT2B(%1,"winterBarley") / p_cardTcur , 2)   ;

     p_sumResT2B(%1,"GR_WB_pass")    =  round (  sum(    (t_n(tCur,nCur),c_p_t_i(%1,"winterBarley",plot,till,intens),labperiod)  , p_crop_op_per_till("winterBarley","Herb",labPeriod,till,intens)
                                                *      v_cropHa.l(%1,"winterBarley",plot,till,intens,tCur,nCur)     )
                                                     /     p_sumResT2B(%1,"winterBarley") / p_cardTcur , 2)    ;


      p_sumResT2B(%1,"GR_Load_Pot") =  p_pestLoadRes(%1,"potatoes","SumCrops","L")  ;
      p_sumResT2B(%1,"GR_Load_SB")  =  p_pestLoadRes(%1,"sugarbeet","SumCrops","L")  ;
      p_sumResT2B(%1,"GR_Load_WW")  =  p_pestLoadRes(%1,"winterWheat","SumCrops","L")  ;
      p_sumResT2B(%1,"GR_Load_WB")  =  p_pestLoadRes(%1,"winterBarley","SumCrops","L")  ;


 display p_pestLoadRes ;
 display p_sumResT2B ;
$endif.tech
*
* --- write the profit, acreages and herd size to log, and to HTML page if the natch mode is running
*
  put_utility batch 'msglog'   / 'html profit : ',p_sumRes(%1,%2,"profit"):0:0;
  loop (curCrops $ (p_sumRes(%1,%2,curCrops) gt 0),
      put_utility batch 'msglog'   / 'html ',curCrops.tl:0:0,' : ',p_sumRes(%1,%2,curCrops):0:2;
  );
  $$iftheni.possHerds defined possHerds
     loop (possHerds $ (p_sumRes(%1,%2,possHerds) gt 0),
        put_utility batch 'msglog'   / 'html ',possherds.tl:0:0,' : ',p_sumRes(%1,%2,possHerds):0:2;
    );
  $$endif.possherds
