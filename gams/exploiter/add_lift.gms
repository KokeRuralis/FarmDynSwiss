********************************************************************************
$ontext

   CAPRI project

   GAMS file : ADD_LIFT.GMS

   @purpose  :
   @author   :
   @date     : 09.03.21
   @since    :
   @refDoc   :
   @seeAlso  :
   @calledBy :

$offtext
********************************************************************************
$ontext
$ifi not defined p_liftIndicators parameter p_liftIndicators; scalar p_wageImp / 20 /,p_rentImp / 500 /, p_capImp /0.03/;

*
* --- supportive indicators
*
  p_liftIndicators("econ-supp","output")
     =  sum( t_n(tCur,nCur), sum(sys,v_salRev(sys,tCur,nCur))* p_probn(nCur))/card(tCur) * 0.001;

  p_liftIndicators("econ-supp","prem")
     =  sum( t_n(tCur,nCur), v_premTot(tCur,nCur)* p_probn(nCur))/card(tCur) * 0.001;

  p_liftIndicators("econ-supp","land")
     =  sum( (landType,soil,t_n(tCur,nCur)), v_croppedLand(landType,soil,tCur,nCur) * p_probn(nCur))/card(tCur);

  p_liftIndicators("econ-supp","labour")
    = sum( t_n(tCur,nCur), v_labOnFarm.l(tCur,nCur) * p_probn(nCur))/card(tCur);

  p_liftIndicators("econ-supp","depr")
    = sum( t_n(tCur,nCur), v_depr.l(tCur,nCur) * p_probn(nCur))/card(tCur) * 0.001;

  p_liftIndicators("econ-supp","varCost")
    = sum( t_n(tCur,nCur), v_varCost.l(tCur,nCur) * p_probn(nCur))/card(tCur) * 0.001;

  p_liftIndicators("econ-supp","profitTax")
= sum( t_n(tCur,nCur), v_profitTax.l(tCur,nCur)    * p_probn(nCur))/card(tCur) * 0.001;


  p_liftIndicators("econ","mark orientation") $  (p_liftIndicators("econ","output")+p_liftIndicators("econ","prem"))
   = p_liftIndicators("econ","output")/(p_liftIndicators("econ","output")+p_liftIndicators("econ","prem"));
*
* --- revenue-cost-ratios
*
  p_liftIndicators("econ-rev/cost","priv") $ sum( t_n(tCur,nCur), v_varCost(tCur,nCur) + v_depr(tCur,nCur))
     =  sum( t_n(tCur,nCur), sum(sys,v_salRev(sys,tCur,nCur))* p_probn(nCur))
      / sum( t_n(tCur,nCur), (v_varCost(tCur,nCur) + v_depr(tCur,nCur))*p_probn(nCur));

  p_liftIndicators("econ-rev/Cost","pub") $ sum( t_n(tCur,nCur), v_varCost(tCur,nCur) + v_depr(tCur,nCur))
     =  sum( t_n(tCur,nCur), (sum(sys,v_salRev(sys,tCur,nCur))+v_premTot(tCur,nCur))* p_probn(nCur))
      / sum( t_n(tCur,nCur), (v_varCost(tCur,nCur) + v_depr(tCur,nCur))*p_probn(nCur));


  p_liftIndicators("econ-rev/Cost","priv, imp") $ sum( t_n(tCur,nCur), v_varCost(tCur,nCur) + v_depr(tCur,nCur))
     =  sum( t_n(tCur,nCur), sum(sys,v_salRev(sys,tCur,nCur))* p_probn(nCur))
      / sum( t_n(tCur,nCur), (v_varCost(tCur,nCur) + v_depr(tCur,nCur)*(1+p_capImp)
                             +  v_labOnFarm.l(tCur,nCur)*p_wageImp
                             +   sum( (landType,soil), v_croppedLand(landType,soil,tCur,nCur))*p_rentImp) * p_probn(nCur));

  p_liftIndicators("econ-rev/Cost","pub,imp") $ sum( t_n(tCur,nCur), v_varCost(tCur,nCur) + v_depr(tCur,nCur))
     =  sum( t_n(tCur,nCur), (sum(sys,v_salRev(sys,tCur,nCur))+v_premTot(tCur,nCur))* p_probn(nCur))
      / sum( t_n(tCur,nCur), (v_varCost(tCur,nCur) + v_depr(tCur,nCur)*(1+p_capImp)
                             +  v_labOnFarm.l(tCur,nCur)*p_wageImp
                             +   sum( (landType,soil), v_croppedLand(landType,soil,tCur,nCur))*p_rentImp) * p_probn(nCur));

*
* --- partial productivities: profitTaxs divided by physical used (hours, hectares, depreciation=investments in current Euros)
*
  p_liftIndicators("econ-partProd","labour") $ sum( t_n(tCur,nCur), v_labOnFarm.l(tCur,nCur))
   =  sum( t_n(tCur,nCur), v_profitTax.l(tCur,nCur)    * p_probn(nCur))
    / sum( t_n(tCur,nCur), v_labOnFarm.l(tCur,nCur) * p_probn(nCur));

 p_liftIndicators("econ-partProd","land") $ sum( (landType,soil,t_n(tCur,nCur)), v_croppedLand(landType,soil,tCur,nCur))
    =  sum( t_n(tCur,nCur), v_profitTax.l(tCur,nCur)    * p_probn(nCur))
     / sum( (landType,soil,t_n(tCur,nCur)), v_croppedLand(landType,soil,tCur,nCur) * p_probn(nCur));

 p_liftIndicators("econ-partProd","cap") $ sum( (t_n(tCur,nCur)), v_depr(tCur,nCur))
    =  sum( t_n(tCur,nCur), v_profitTax.l(tCur,nCur)    * p_probn(nCur))
     / sum( (t_n(tCur,nCur)), v_depr(tCur,nCur) * p_probn(nCur)) * 100;

 p_liftIndicators("econ-partProd","intermed") $ sum( (t_n(tCur,nCur)), v_varCost(tCur,nCur))
    =  sum( t_n(tCur,nCur), v_profitTax.l(tCur,nCur)    * p_probn(nCur))
     / sum( (t_n(tCur,nCur)), v_varCost(tCur,nCur) * p_probn(nCur)) * 100;
*
* --- marginal values from FOC of simulation model
*
 p_liftIndicators("econ-margVal","lab_yearly") = p_sumres("margLab");

 p_liftIndicators("econ-margVal","lab_peak")
    =  smax( (m,t_n(tCur,nCur)),-labTotM_.m(tCur,nCur,m))
     / sum( (t_n(tCur,nCur)), p_probn(nCur));

 p_liftIndicators("econ-margVal","land_arab") = p_sumRes("margArab");
 p_liftIndicators("econ-margVal","land_gras") = p_sumRes("margGras");

 p_liftIndicators("econ-margVal","land_avg")
   = (p_sumRes("margGras")*(p_nGrasLand+p_nPastLand)+p_sumRes("margArab")*p_nArabLand)
                          /(p_nGrasLand+p_nPastLand+p_nArabLand) ;
*
* --- labour indicators
*

p_liftIndicators("labour","LabourCrop") $  p_liftIndicators("econ-supp","labour")
 = sum( t_n(tCur,nCur), v_labCrop.l(tCur,nCur) * p_probn(nCur))/card(tCur);

 p_liftIndicators("labour","LabourHerd") $  (p_liftIndicators("econ-supp","labour"))
  =  0
  $$ifi %herd%==true + sum( t_n(tCur,nCur), v_labHerd.l(tCur,nCur) * p_probn(nCur))/card(tCur)
  ;

  p_liftIndicators("labour","LabourManagement") $  p_liftIndicators("econ-supp","labour")
   = sum( t_n(tCur,nCur), v_labManag.l(tCur,nCur) * p_probn(nCur))/card(tCur);

   p_liftIndicators("labour","LeisureTot")
    = sum( t_n(tCur,nCur), v_leisureTot.l(tCur,nCur) * p_probn(nCur))/card(tCur);

   p_liftIndicators("labour","OffFarm")
   = sum( t_n(tCur,nCur),  v_labOffTot(tCur,nCur) * p_probn(nCur))/card(tCur);

   p_liftIndicators("labour","OffFarm, Euro")
   = sum( t_n(tCur,nCur),  v_offFarmWages(tCur,nCur) * p_probn(nCur))/card(tCur);

*
* --- monthly on-farm work
*
p_liftIndicators("labour",m) $  p_liftIndicators("econ-supp","labour")
 = sum( t_n(tCur,nCur),
                  (  v_labCropSM.l(tCur,nCur,m)
$ifi %herd%==true  + v_labHerdM.l(tCur,nCur,m)
                   + v_labManag.l(tCur,nCur)/card(m)
                   ) * p_probn(nCur)) /card(tCur);

* --- Hired labor in hours and number of workers

p_liftIndicators("labour","LabourHoursHired") $  p_liftIndicators("econ-supp","labour")
    = 0
     $$ifi "%allowHiring%"=="true" + sum( t_n(tCur,nCur), v_hireWorkers.l(tcur,nCur) * %workHoursHired% * p_probn(nCur))/card(tCur)
     ;

p_liftIndicators("labour","WorkersHired") $  p_liftIndicators("econ-supp","labour")
    = 0
      $$ifi "%allowHiring%"=="true" + sum( t_n(tCur,nCur), v_hireWorkers.l(tcur,nCur) * p_probn(nCur))/card(tCur)
     ;
*
* --- input / input ratios relevant for env. indicator
*
 p_liftIndicators("env-rat","N-Min kg/ha") $ p_liftIndicators("econ-supp","land")
  = sum( (curInputs(syntFertilizer),curSys,t_n(tCur,nCur)), v_buy(syntFertilizer,curSys,tCur,nCur)*p_probn(nCur)*p_nutInSynt(syntFertilizer,"N"))
    / (card(tCur)*p_liftIndicators("econ-supp","land"));

 p_liftIndicators("env-rat","P-Min kg/ha") $ p_liftIndicators("econ-supp","land")
  = sum( (curInputs(syntFertilizer),curSys,t_n(tCur,nCur)), v_buy(syntFertilizer,curSys,tCur,nCur)*p_probn(nCur)*p_nutInSynt(syntFertilizer,"P"))
    / (card(tCur)*p_liftIndicators("econ-supp","land"));

$iftheni.manure "%manure%"=="true"

  p_liftIndicators("env-rat","N-Org kg/ha") $ p_liftIndicators("econ-supp","land")
   = sum( (c_p_t_i(curCrops,plot,till,intens),manApplicType_manType(ManApplicType,curManType),t_n(tCur,nCur),m),
              v_manDist(curCrops,plot,till,intens,ManApplicType,curManType,tCur,nCur,m)*p_probn(nCur)
                      * sum(manChain,p_nut2inMan("NTAN",curManType,manChain)+p_nut2inMan("NORG",curManType,manChain)))
    / (card(tCur)*p_liftIndicators("econ-supp","land"));

  p_liftIndicators("env-rat","P-Org kg/ha") $ p_liftIndicators("econ-supp","land")
   = sum( (c_p_t_i(curCrops,plot,till,intens),manApplicType_manType(ManApplicType,curManType),t_n(tCur,nCur),m),
              v_manDist(curCrops,plot,till,intens,ManApplicType,curManType,tCur,nCur,m)*p_probn(nCur)
                      * sum(manChain,p_nut2inMan("P",curManType,manChain)))
    / (card(tCur)*p_liftIndicators("econ-supp","land"));


$endif.manure
$iftheni.herd "%herd%"=="true"

  p_liftIndicators("env-rat","LU/ha") $ p_liftIndicators("econ-supp","land")
    =  sum( t_n(tCur,nCur),v_sumGV(tCur,nCur)*p_probn(nCur)) /(card(tCur)*p_liftIndicators("econ-supp","land"));

  p_liftIndicators("env-rat","Bought feed Euro/ha") $ p_liftIndicators("econ-supp","land")
    =  sum( (curFeeds,curSys,t_n(tCur,nCur),sameas(curFeeds,inputs)),
              v_buyCost(Inputs,curSys,tCur,nCur)*p_probn(nCur)) /(card(tCur)*p_liftIndicators("econ-supp","land"));

$endif.herd

 p_liftIndicators("env-rat","Herb Euro/ha") $ p_liftIndicators("econ-supp","land")
  = sum( (curSys,t_n(tCur,nCur)), v_buyCost("Herb",curSys,tCur,nCur)*p_probn(nCur))/ (card(tCur)*p_liftIndicators("econ-supp","land"));

 p_liftIndicators("env-rat","Fung Euro/ha") $ p_liftIndicators("econ-supp","land")
  = sum( (curSys,t_n(tCur,nCur)), v_buyCost("Fung",curSys,tCur,nCur)*p_probn(nCur))/ (card(tCur)*p_liftIndicators("econ-supp","land"));

 p_liftIndicators("env-rat","Insect Euro/ha") $ p_liftIndicators("econ-supp","land")
  = sum( (curSys,t_n(tCur,nCur)), v_buyCost("Insect",curSys,tCur,nCur)*p_probn(nCur))/ (card(tCur)*p_liftIndicators("econ-supp","land"));

*
* --- environmental indicators
*
$iftheni.envAcc "%EnvAcc%"=="true"

 p_liftIndicators("env-farm","N-Leach_perHa") $ p_liftIndicators("econ-supp","land")
  = sum( t_n(tCur,nCur), v_leach.l(tCur,nCur)*p_probn(nCur))/(p_liftIndicators("econ-supp","land")*card(tCur));

 p_liftIndicators("env-farm","P-erosion_loss_perHa") $ p_liftIndicators("econ-supp","land")
  = sum( t_n(tCur,nCur), v_lossPhos.l(tCur,nCur)*p_probn(nCur))/(p_liftIndicators("econ-supp","land")*card(tCur));

 p_liftIndicators("env-farm","humBalance_perHa") $ p_liftIndicators("econ-supp","land")
  = sum( t_n(tCur,nCur), v_humBal.l(tCur,nCur) *p_probn(nCur))/(p_liftIndicators("econ-supp","land")*card(tCur)) * 0.001;

 p_liftIndicators("env-LCA",emissions) $ p_liftIndicators("econ-supp","land")
   = sum( t_n(tCur,nCur), v_emissionsSum.l(emissions,tCur,nCur)*p_probn(nCur))/(p_liftIndicators("econ-supp","land")*card(tCur));

 p_liftIndicators("env-LCA",emCat) $ p_liftIndicators("econ-supp","land")
   = sum( t_n(tCur,nCur), v_emissionsCatSum.l(emCat,tCur,nCur)*p_probn(nCur))/(p_liftIndicators("econ-supp","land")*card(tCur));

 p_liftIndicators("env-LCA","GWP") = p_liftIndicators("env-LCA","GWP")*0.001;
 p_liftIndicators("env-LCA","CO2") = p_liftIndicators("env-LCA","CO2")*0.001;
 p_liftIndicators("env-LCA","CH4") = p_liftIndicators("env-LCA","CH4")*0.001;
*
* --- Paracchini&Britz index from Shannon, N-Fert and Rum-Dens
*
 p_liftIndicators("env-biod","Paracchini&Britz") = sum(t_n(tCur,nCur),p_sollIndex(tCur)*p_probn(nCur))/sum(t_n(tCur,nCur),p_probn(nCur));
*
* --- SMART (FIBL)
*
 p_liftIndicators("env-biod","SMART_specDiv") =   p_SpecDiv;
 p_liftIndicators("env-biod","SMART_ecoDiv")  =   p_ecoDiv;
 p_liftIndicators("env-biod","SMART_genDiv")  =   p_genDiv;
 p_liftIndicators("env-biod","SMART_bioDiv")  =   p_bioDiv;
*
* --- Salca
*
$iftheni.salca defined biodType_e

 p_liftIndicators("env-biod",biodType_e)     = p_res("Base","%exploiterDim2%","total",biodType_e,"cur_Gav","mean")/50;
 p_liftIndicators("env-biod","SALCA, sum")   = p_res("Base","%exploiterDim2%","total","summary","cur_Gav","mean")/50;

$endif.salca
*
* ---  N/P balances
*
 p_liftIndicators(nut,fertSour) $ p_liftIndicators("econ-supp","land")
  = sum( (c_p_t_i(curCrops,plot,till,intens),t_n(tCur,nCur)),
                                         v_nutBalCropSour(fertSour,curCrops,plot,till,intens,nut,tCur,nCur)*p_probn(nCur))
                                         /(p_liftIndicators("econ-supp","land")*card(tCur));

$iftheni.manure "%manure%"=="true"
*

 $$iftheni.herd "%herd%"=="true"

   p_liftIndicators(nut,"NBExcretion") $ p_liftIndicators("econ-supp","land")
     = sum((nut2_nut(nut2,nut),t_n(tCur,nCur)), v_nut2ManureT(nut2,tCur,ncur)*p_probn(nCur))
                                           /(p_liftIndicators("econ-supp","land")*card(tCur));

 $$else.herd

     p_liftIndicators(nut,"NBExcretion") = 0;

 $$endif.herd

 $$iftheni.ms %manureStorage% == true
    p_liftIndicators(nut,"NBStorageLoss") $ p_liftIndicators("econ-supp","land")
     = sum((curManChain(manChain),nut2_nut(nut2,nut),t_n(tCur,nCur),m),v_nutLossInStorage(manChain,nut2,tCur,nCur,m)*p_probn(nCur))
                                         /(p_liftIndicators("econ-supp","land")*card(tCur));
 $$else.ms
   p_liftIndicators(nut,"NBStorageLoss") = 0;
 $$endif.ms


 p_liftIndicators(nut,"NBImport") $ p_liftIndicators("econ-supp","land")
   = sum((nut2_nut(nut2,nut),t_n(tCur,nCur),m), ( 0
               $$ifi "%AllowManureImport%" == "true"    +  v_nut2import(nut2,tCur,nCur,m)
               $$iftheni.biogas %biogas% == true
                 +  sum( (curBhkw(bhkw),curEeg(eeg),curmaM),v_nut2ManurePurch("LiquidBiogas",nut2,curmaM,tCur,nCur,m))
                 +  v_nutCropBiogasM("LiquidBiogas",nut2,tCur,nCur,m)
               $$endif.biogas
                                              )*p_probn(nCur))
                                         /(p_liftIndicators("econ-supp","land")*card(tCur));

 p_liftIndicators(nut,"NBExport") $ p_liftIndicators("econ-supp","land")
   = sum((curManChain(manChain),nut2_nut(nut2,nut),t_n(tCur,nCur),m), ( 0
      $$ifi "%AllowManureExport%"=="true"  +  v_nut2export(manChain,nut2,tCur,nCur,m)
      $$ifi "%AllowBiogasExchange"=="true" +  v_nutExport(nut,t,n)
      $$ifi not "%emissionRight%"==0       +  v_nut2ExportMER(manChain,nut2,tCur,nCur,m)
                                                )*p_probn(nCur))
                                         /(p_liftIndicators("econ-supp","land")*card(tCur));

$else.manure
   p_liftIndicators(nut,"NBExcretion")   = 0;
   p_liftIndicators(nut,"NBStorageLoss") = 0;
   p_liftIndicators(nut,"NBImport")      = 0;
   p_liftIndicators(nut,"NBExport")      = 0;

$endif.manure

 set relNLosses(emissions) "Emissions losses in N" / NH3,N2,N2O,NOX /;

 p_liftIndicators("N",relNLosses) $ p_liftIndicators("econ-supp","land")
    = sum( t_n(tCur,nCur), v_emissionsSum(relNLosses,tCur,nCur)*p_probn(nCur))
                                         /(p_liftIndicators("econ-supp","land")*card(tCur));

 p_liftIndicators(nut,"NBTotal")
   =    p_liftIndicators(nut,"NBBasnut")
    +   p_liftIndicators(nut,"NBExcretion")
    +   p_liftIndicators(nut,"NBLegumes")
    +   p_liftIndicators(nut,"NBImport")
    +   p_liftIndicators(nut,"NBMinFert");

 p_liftIndicators(nut,"NBLoss")
   =
       p_liftIndicators(nut,"NBMinFertLoss")
    +  p_liftIndicators(nut,"NBPastureLoss")
    +  p_liftIndicators(nut,"NBStorageLoss")
    +  p_liftIndicators(nut,"NBManureLoss");

 p_liftIndicators(nut,"NBSoilBalance")
  = p_liftIndicators(nut,"NBTotal") - p_liftIndicators(nut,"NBLoss") - p_liftIndicators(nut,"NBCropNeed");





$setglobal addIndicators p_liftIndicators
$offtext
