********************************************************************************
$ontext

   FarmDyn project

   GAMS file : STORE_RES_ENVACC.GMS

   @purpose  :
   @author   :
   @date     : 07.03.25
   @since    :
   @refDoc   :
   @seeAlso  :
   @calledBy :

$offtext
********************************************************************************


********************************************************************************
*
*--- Emissions from environmental accounting
*
********************************************************************************

$$iftheni.herd %herd% == true

* --- Methane from enteric fermentation / animal respiration

    p_res(%1,%2,"entFermCH4","Quant","",tCur)       =  sum((curChain,t_n(tCur,nCur)), p_probn(nCur) *v_emissions.l(curChain,"entFerm","CH4",tCur,nCur) ) ;
    p_res(%1,%2,"entFermCH4","Quant","","mean")     =  sum( tCur,p_res(%1,%2,"entFermCH4","Quant","",tCur) ) / p_cardtCur ;

* --- Emissions in storage and stable

    p_res(%1,%2,"staStoNH3","Quant","",tCur)       =  sum((curChain,t_n(tCur,nCur)), p_probn(nCur) *v_emissions.l(curChain,"staSto","NH3",tCur,nCur) ) ;
    p_res(%1,%2,"staStoNH3","Quant","","mean")     =  sum( tCur,p_res(%1,%2,"staStoNH3","Quant","",tCur) ) / p_cardtCur ;

    p_res(%1,%2,"staStoN2O","Quant","",tCur)       =  sum((curChain,t_n(tCur,nCur)), p_probn(nCur)* v_emissions.l(curChain,"staSto","N2O",tCur,nCur) ) ;
    p_res(%1,%2,"staStoN2O","Quant","","mean")     =  sum( tCur,p_res(%1,%2,"staStoN2O","Quant","",tCur) ) / p_cardtCur ;

    p_res(%1,%2,"staStoNOx","Quant","",tCur)       =  sum((curChain,t_n(tCur,nCur)), p_probn(nCur)* v_emissions.l(curChain,"staSto","NOx",tCur,nCur) ) ;
    p_res(%1,%2,"staStoNOx","Quant","","mean")     =  sum( tCur,p_res(%1,%2,"staStoNOx","Quant","",tCur) ) / p_cardtCur ;

    p_res(%1,%2,"staStoN2","Quant","",tCur)        =  sum((curChain,t_n(tCur,nCur)), p_probn(nCur)* v_emissions.l(curChain,"staSto","N2",tCur,nCur) ) ;
    p_res(%1,%2,"staStoN2","Quant","","mean")      =  sum( tCur,p_res(%1,%2,"staStoN2","Quant","",tCur) ) / p_cardtCur ;

    p_res(%1,%2,"staStoN2Oind","Quant","",tCur)    =  sum((curChain,t_n(tCur,nCur)), p_probn(nCur)* v_emissions.l(curChain,"staSto","N2Oind",tCur,nCur) ) ;
    p_res(%1,%2,"staStoN2Oind","Quant","","mean")  =  sum( tCur, p_res(%1,%2,"staStoN2Oind","Quant","",tCur) ) / p_cardtCur ;

    p_res(%1,%2,"staStoCH4","Quant","",tCur)    =  sum((curChain,t_n(tCur,nCur)), p_probn(nCur)* v_emissions.l(curChain,"staSto","CH4",tCur,nCur) ) ;
    p_res(%1,%2,"staStoCH4","Quant","","mean")  =  sum( tCur, p_res(%1,%2,"staStoCH4","Quant","",tCur) ) / p_cardtCur ;

    $$iftheni.dairy %cattle% == true

* --- Emissions from manure excretion on pasture

      p_res(%1,%2,"manPasNH3","Quant","",tCur)       =  sum ( (t_n(tCur,nCur)), p_probn(nCur) * v_emissions.l("","past","NH3",tCur,nCur)  );
      p_res(%1,%2,"manPasNH3","Quant","","mean")     =  sum( tCur,p_res(%1,%2,"manPasNH3","Quant","",tCur) ) / p_cardtCur ;

      p_res(%1,%2,"manPasN2O","Quant","",tCur)       =  sum ( (t_n(tCur,nCur)), p_probn(nCur) * v_emissions.l("","past","N2O",tCur,nCur)  );
      p_res(%1,%2,"manPasN2O","Quant","","mean")     =  sum( tCur,p_res(%1,%2,"manPasN2O","Quant","",tCur) ) / p_cardtCur ;

      p_res(%1,%2,"manPasNOx","Quant","",tCur)       =  sum ( (t_n(tCur,nCur)), p_probn(nCur) * v_emissions.l("","past","NOx",tCur,nCur)  );
      p_res(%1,%2,"manPasNOx","Quant","","mean")     =  sum( tCur,p_res(%1,%2,"manPasNOx","Quant","",tCur) ) / p_cardtCur ;

      p_res(%1,%2,"manPasN2","Quant","",tCur)        =  sum ( (t_n(tCur,nCur)), p_probn(nCur) * v_emissions.l("","past","N2",tCur,nCur)  );
      p_res(%1,%2,"manPasN2","Quant","","mean")      =  sum( tCur,p_res(%1,%2,"manPasN2","Quant","",tCur) ) / p_cardtCur ;

      p_res(%1,%2,"manPasN2Oind","Quant","",tCur)    =  sum ( (t_n(tCur,nCur)), p_probn(nCur) * v_emissions.l("","past","N2Oind",tCur,nCur)  );
      p_res(%1,%2,"manPasN2Oind","Quant","","mean")  =  sum( tCur,p_res(%1,%2,"manPasN2Oind","Quant","",tCur) ) / p_cardtCur ;

      p_res(%1,%2,"manPasCH4","Quant","",tCur)    =  sum((curChain,t_n(tCur,nCur)), p_probn(nCur)* v_emissions.l(curChain,"past","CH4",tCur,nCur) ) ;
      p_res(%1,%2,"manPasCH4","Quant","","mean")  =  sum( tCur, p_res(%1,%2,"manPasCH4","Quant","",tCur) ) / p_cardtCur ;

    $$endif.dairy

* --- Emissions from manure application

   p_res(%1,%2,"applManNH3","Quant","",tCur)      =    sum((curChain,t_n(tCur,nCur)), p_probn(nCur) * v_emissions.l(curChain,"manAppl","NH3",tCur,nCur)  );
   p_res(%1,%2,"applManNH3","Quant","","mean")    =    sum( tCur,p_res(%1,%2,"applManNH3","Quant","",tCur)  ) / p_cardtCur ;

   p_res(%1,%2,"applManN2O","Quant","",tCur)      =    sum((curChain,t_n(tCur,nCur)), p_probn(nCur) * v_emissions.l(curChain,"manAppl","N2O",tCur,nCur)  );
   p_res(%1,%2,"applManN2O","Quant","","mean")    =    sum( tCur,p_res(%1,%2,"applManN2O","Quant","",tCur) ) / p_cardtCur ;

   p_res(%1,%2,"applManNOx","Quant","",tCur)      =    sum((curChain,t_n(tCur,nCur)), p_probn(nCur) * v_emissions.l(curChain,"manAppl","NOx",tCur,nCur)  );
   p_res(%1,%2,"applManNOx","Quant","","mean")    =    sum( tCur, p_res(%1,%2,"applManNOx","Quant","",tCur) ) / p_cardtCur ;

   p_res(%1,%2,"applManN2","Quant","",tCur)       =    sum((curChain,t_n(tCur,nCur)), p_probn(nCur) * v_emissions.l(curChain,"manAppl","N2",tCur,nCur)  );
   p_res(%1,%2,"applManN2","Quant","","mean")     =    sum( tCur,p_res(%1,%2,"applManN2","Quant","",tCur)  ) / p_cardtCur ;

   p_res(%1,%2,"applManN2Oind","Quant","",tCur)   =    sum((curChain,t_n(tCur,nCur)), p_probn(nCur) * v_emissions.l(curChain,"manAppl","N2Oind",tCur,nCur)  );
   p_res(%1,%2,"applManN2Oind","Quant","","mean") =    sum( tCur,p_res(%1,%2,"applManN2Oind","Quant","",tCur)  ) / p_cardtCur ;

$$endif.herd

*  --- Emissions from mineral N fertilizer application

  p_res(%1,%2,"applMinNH3","Quant","",tCur)      =    sum((curChain,t_n(tCur,nCur)), p_probn(nCur) * v_emissions.l(curChain,"minAppl","NH3",tCur,nCur)  );
  p_res(%1,%2,"applMinNH3","Quant","","mean")    =    sum( tCur,p_res(%1,%2,"applMinNH3","Quant","",tCur)  ) / p_cardtCur ;

  p_res(%1,%2,"applMinN2O","Quant","",tCur)      =    sum((curChain,t_n(tCur,nCur)), p_probn(nCur) * v_emissions.l(curChain,"minAppl","N2O",tCur,nCur)  );
  p_res(%1,%2,"applMinN2O","Quant","","mean")    =    sum( tCur,p_res(%1,%2,"applMinN2O","Quant","",tCur) ) / p_cardtCur ;

  p_res(%1,%2,"applMinNOx","Quant","",tCur)      =    sum((curChain,t_n(tCur,nCur)), p_probn(nCur) * v_emissions.l(curChain,"minAppl","NOx",tCur,nCur)  );
  p_res(%1,%2,"applMinNOx","Quant","","mean")    =    sum( tCur, p_res(%1,%2,"applMinNOx","Quant","",tCur) ) / p_cardtCur ;

  p_res(%1,%2,"applMinN2","Quant","",tCur)       =    sum((curChain,t_n(tCur,nCur)), p_probn(nCur) * v_emissions.l(curChain,"minAppl","N2",tCur,nCur)  );
  p_res(%1,%2,"applMinN2","Quant","","mean")     =    sum( tCur,p_res(%1,%2,"applMinN2","Quant","",tCur)  ) / p_cardtCur ;

  p_res(%1,%2,"applMinN2Oind","Quant","",tCur)   =    sum((curChain,t_n(tCur,nCur)), p_probn(nCur) * v_emissions.l(curChain,"minAppl","N2Oind",tCur,nCur)  );
  p_res(%1,%2,"applMinN2Oind","Quant","","mean") =    sum( tCur,p_res(%1,%2,"applMinN2Oind","Quant","",tCur)  ) / p_cardtCur ;

*  --- CO2 emissions from liming

  p_res(%1,%2,"limingCO2","Quant","",tCur)   =    sum((curChain,t_n(tCur,nCur)), p_probn(nCur) * v_emissions.l(curChain,"field","CO2",tCur,nCur)  );
  p_res(%1,%2,"limingCO2","Quant","","mean") =    sum( tCur,p_res(%1,%2,"limingCO2","Quant","",tCur)  ) / p_cardtCur ;

*  --- N2O emissions from crop residues

  p_res(%1,%2,"cropResiN2O","Quant","",tCur)   =    sum((curChain,t_n(tCur,nCur)), p_probn(nCur) * v_emissions.l(curChain,"field","N2O",tCur,nCur)  );
  p_res(%1,%2,"cropResiN2O","Quant","","mean") =    sum( tCur,p_res(%1,%2,"cropResiN2O","Quant","",tCur)  ) / p_cardtCur ;

*  --- PArticulate matter formation from cropping

  p_res(%1,%2,"croppingPMF25","Quant","",tCur)   =    sum((curChain,t_n(tCur,nCur)), p_probn(nCur) * v_emissions.l(curChain,"field","PM25",tCur,nCur)  );
  p_res(%1,%2,"croppingPMF25","Quant","","mean") =    sum( tCur,p_res(%1,%2,"croppingPMF25","Quant","",tCur)  ) / p_cardtCur ;

  p_res(%1,%2,"croppingPMF10","Quant","",tCur)   =    sum((curChain,t_n(tCur,nCur)), p_probn(nCur) * v_emissions.l(curChain,"field","PM10",tCur,nCur)  );
  p_res(%1,%2,"croppingPMF10","Quant","","mean") =    sum( tCur,p_res(%1,%2,"croppingPMF10","Quant","",tCur)  ) / p_cardtCur ;

  p_res(%1,%2,"croppingTSP","Quant","",tCur)   =    sum((curChain,t_n(tCur,nCur)), p_probn(nCur) * v_emissions.l(curChain,"field","TSP",tCur,nCur)  );
  p_res(%1,%2,"croppingTSP","Quant","","mean") =    sum( tCur,p_res(%1,%2,"croppingTSP","Quant","",tCur)  ) / p_cardtCur ;

*  --- Particulate matter formation stable

$$iftheni.h %herd% ==true

  p_res(%1,%2,"stastoPMF25","Quant","",tCur)   =    sum((curChain,t_n(tCur,nCur)), p_probn(nCur) * v_emissions.l(curChain,"staSto","PM25",tCur,nCur)  );
  p_res(%1,%2,"stastoPMF25","Quant","","mean") =    sum( tCur,p_res(%1,%2,"stastoPMF25","Quant","",tCur)  ) / p_cardtCur ;

  p_res(%1,%2,"stastoPMF10","Quant","",tCur)   =    sum((curChain,t_n(tCur,nCur)), p_probn(nCur) * v_emissions.l(curChain,"staSto","PM10",tCur,nCur)  );
  p_res(%1,%2,"stastoPMF10","Quant","","mean") =    sum( tCur,p_res(%1,%2,"stastoPMF10","Quant","",tCur)  ) / p_cardtCur ;

  p_res(%1,%2,"stastoTSP","Quant","",tCur)   =    sum((curChain,t_n(tCur,nCur)), p_probn(nCur) * v_emissions.l(curChain,"staSto","TSP",tCur,nCur)  );
  p_res(%1,%2,"stastoTSP","Quant","","mean") =    sum( tCur,p_res(%1,%2,"stastoTSP","Quant","",tCur)  ) / p_cardtCur ;
$$endif.h

* --- Emissions from bought inputs

  p_res(%1,%2,"inputCO2","Quant","",tCur)   =    sum((curChain,t_n(tCur,nCur)), p_probn(nCur) * v_emissions.l(curChain,"Input","CO2",tCur,nCur)  );
  p_res(%1,%2,"inputCO2","Quant","","mean") =    sum( tCur,p_res(%1,%2,"inputCO2","Quant","",tCur)  ) / p_cardtCur ;

* --- Total N leaching for the whole farm

  p_res(%1,%2,"leachN","Quant","",tCur)      =    sum((t_n(tCur,nCur)), p_probn(nCur) * v_leach.l(tCur,nCur)  ) ;
  p_res(%1,%2,"leachN","Quant","","mean")    =    sum( tCur,p_res(%1,%2,"leachN","Quant","",tCur)  ) / p_cardtCur ;

* --- Total P Lost from fields

  p_res(%1,%2,"lossP","Quant","",tCur)      =    sum((curCrops,t_n(tCur,nCur)), p_probn(nCur) * v_lossPhos.l(tCur,nCur)  ) ;
  p_res(%1,%2,"lossP","Quant","","mean")    =    sum( tCur,p_res(%1,%2,"lossP","Quant","",tCur)  ) / p_cardtCur ;

* --- Humus losses from fields

  p_res(%1,%2,"humBal","Quant","",tCur)      =    sum((curCrops,t_n(tCur,nCur)), p_probn(nCur) * v_humBal.l(tCur,nCur)  ) ;
  p_res(%1,%2,"humBal","Quant","","mean")    =    sum( tCur,p_res(%1,%2,"humBal","Quant","",tCur)  ) / p_cardtCur ;


*--- Indirect NOx emissions from leaching

  p_res(%1,%2,"leachN2Oind","Quant","",tCur)      =    sum((curChain,t_n(tCur,nCur)), p_probn(nCur) *  v_emissionsYear.l(curChain,"field","N2Oind",tCur,nCur) );
  p_res(%1,%2,"leachN2Oind","Quant","","mean")    =    sum( tCur, p_res(%1,%2,"applMinNOx","Quant","",tCur) ) / p_cardtCur ;

*
* --- Chracterized emissions by sources
*
*     --- Global Warming potential

p_res(%1,%2,"totGWP","Quant","",tCur)      =    sum((t_n(tCur,nCur)), p_probn(nCur) *   v_emissionsCatSum.l("GWP",tCur,nCur) );
p_res(%1,%2,"totGWP","Quant","","mean")    =    sum( tCur, p_res(%1,%2,"totGWP","Quant","",tCur) ) / p_cardtCur ;

$$iftheni.herd %herd% == true

  p_res(%1,%2,"entFermGWP","Quant","",tCur)      =    sum((curChain,t_n(tCur,nCur)), p_probn(nCur) *   v_emissionsCat.l(curChain,"entFerm","GWP",tCur,ncur) );
  p_res(%1,%2,"entFermGWP","Quant","","mean")    =    sum( tCur, p_res(%1,%2,"entFermGWP","Quant","",tCur) ) / p_cardtCur ;

  $$iftheni.cat %cattle% == true
    p_res(%1,%2,"pastGWP","Quant","",tCur)      =    sum((curChain,t_n(tCur,nCur)), p_probn(nCur) *   v_emissionsCat.l(curChain,"past","GWP",tCur,ncur) );
    p_res(%1,%2,"pastGWP","Quant","","mean")    =    sum( tCur, p_res(%1,%2,"pastGWP","Quant","",tCur) ) / p_cardtCur ;

    p_res(%1,%2,"totGWPperBeef","Quant","",tCur)  $ p_res(%1,%2,"OQuantBeef","sum","",tCur)
        =    p_res(%1,%2,"totGWP","Quant","",tCur) / p_res(%1,%2,"OQuantBeef","sum","",tCur);
    p_res(%1,%2,"totGWPperBeef","Quant","","mean")    =    sum( tCur, p_res(%1,%2,"totGWPperBeef","Quant","",tCur) ) / p_cardtCur ;
  $$endif.cat

  p_res(%1,%2,"staStoGWP","Quant","",tCur)      =    sum((curChain,t_n(tCur,nCur)), p_probn(nCur) *   v_emissionsCat.l(curChain,"staSto","GWP",tCur,ncur) );
  p_res(%1,%2,"staStoGWP","Quant","","mean")    =    sum( tCur, p_res(%1,%2,"staStoGWP","Quant","",tCur) ) / p_cardtCur ;

  p_res(%1,%2,"manApplGWP","Quant","",tCur)      =    sum((curChain,t_n(tCur,nCur)), p_probn(nCur) *   v_emissionsCat.l(curChain,"manAppl","GWP",tCur,ncur) );
  p_res(%1,%2,"manApplGWP","Quant","","mean")    =    sum( tCur, p_res(%1,%2,"manApplGWP","Quant","",tCur) ) / p_cardtCur ;

$$endif.herd

p_res(%1,%2,"minApplGWP","Quant","",tCur)      =    sum((curChain,t_n(tCur,nCur)), p_probn(nCur) *   v_emissionsCat.l(curChain,"minAppl","GWP",tCur,ncur) );
p_res(%1,%2,"minApplGWP","Quant","","mean")    =    sum( tCur, p_res(%1,%2,"minApplGWP","Quant","",tCur) ) / p_cardtCur ;

p_res(%1,%2,"inputGWP","Quant","",tCur)      =    sum((curChain,t_n(tCur,nCur)), p_probn(nCur) *   v_emissionsCat.l(curChain,"input","GWP",tCur,ncur) );
p_res(%1,%2,"inputGWP","Quant","","mean")    =    sum( tCur, p_res(%1,%2,"inputGWP","Quant","",tCur) ) / p_cardtCur ;

p_res(%1,%2,"fieldGWP","Quant","",tCur)      =    sum((curChain,t_n(tCur,nCur)), p_probn(nCur) *   v_emissionsCat.l(curChain,"field","GWP",tCur,ncur) );
p_res(%1,%2,"fieldGWP","Quant","","mean")    =    sum( tCur, p_res(%1,%2,"fieldGWP","Quant","",tCur) ) / p_cardtCur ;

*     --- Particulate matter formation

p_res(%1,%2,"totPMFP","Quant","",tCur)      =    sum((t_n(tCur,nCur)), p_probn(nCur) *   v_emissionsCatSum.l("PMFP",tCur,nCur) );
p_res(%1,%2,"totPMFP","Quant","","mean")    =    sum( tCur, p_res(%1,%2,"totPMFP","Quant","",tCur) ) / p_cardtCur ;

$$iftheni.herd %herd% == true
  p_res(%1,%2,"entFermPMFP","Quant","",tCur)      =    sum((curChain,t_n(tCur,nCur)), p_probn(nCur) *   v_emissionsCat.l(curChain,"entFerm","PMFP",tCur,ncur) );
  p_res(%1,%2,"entFermPMFP","Quant","","mean")    =    sum( tCur, p_res(%1,%2,"entFermPMFP","Quant","",tCur) ) / p_cardtCur ;

  $$iftheni.cat %cattle% == true
    p_res(%1,%2,"pastPMFP","Quant","",tCur)      =    sum((curChain,t_n(tCur,nCur)), p_probn(nCur) *   v_emissionsCat.l(curChain,"past","PMFP",tCur,ncur) );
    p_res(%1,%2,"pastPMFP","Quant","","mean")    =    sum( tCur, p_res(%1,%2,"pastPMFP","Quant","",tCur) ) / p_cardtCur ;

    p_res(%1,%2,"totPMFPperBeef","Quant","",tCur) $ p_res(%1,%2,"OQuantBeef","sum","",tCur) = p_res(%1,%2,"totPMFP","Quant","",tCur) / p_res(%1,%2,"OQuantBeef","sum","",tCur);
    p_res(%1,%2,"totPMFPperBeef","Quant","","mean")    =    sum( tCur, p_res(%1,%2,"totPMFPperBeef","Quant","",tCur) ) / p_cardtCur ;
  $$endif.cat

  p_res(%1,%2,"staStoPMFP","Quant","",tCur)      =    sum((curChain,t_n(tCur,nCur)), p_probn(nCur) *   v_emissionsCat.l(curChain,"staSto","PMFP",tCur,ncur) );
  p_res(%1,%2,"staStoPMFP","Quant","","mean")    =    sum( tCur, p_res(%1,%2,"staStoPMFP","Quant","",tCur) ) / p_cardtCur ;

  p_res(%1,%2,"manApplPMFP","Quant","",tCur)      =    sum((curChain,t_n(tCur,nCur)), p_probn(nCur) *   v_emissionsCat.l(curChain,"manAppl","PMFP",tCur,ncur) );
  p_res(%1,%2,"manApplPMFP","Quant","","mean")    =    sum( tCur, p_res(%1,%2,"manApplPMFP","Quant","",tCur) ) / p_cardtCur ;
$$endif.herd

p_res(%1,%2,"minApplPMFP","Quant","",tCur)      =    sum((curChain,t_n(tCur,nCur)), p_probn(nCur) *   v_emissionsCat.l(curChain,"minAppl","PMFP",tCur,ncur) );
p_res(%1,%2,"minApplPMFP","Quant","","mean")    =    sum( tCur, p_res(%1,%2,"minApplPMFP","Quant","",tCur) ) / p_cardtCur ;

p_res(%1,%2,"inputPMFP","Quant","",tCur)      =    sum((curChain,t_n(tCur,nCur)), p_probn(nCur) *   v_emissionsCat.l(curChain,"input","PMFP",tCur,ncur) );
p_res(%1,%2,"inputPMFP","Quant","","mean")    =    sum( tCur, p_res(%1,%2,"inputPMFP","Quant","",tCur) ) / p_cardtCur ;

p_res(%1,%2,"fieldPMFP","Quant","",tCur)      =    sum((curChain,t_n(tCur,nCur)), p_probn(nCur) *   v_emissionsCat.l(curChain,"field","PMFP",tCur,ncur) );
p_res(%1,%2,"fieldPMFP","Quant","","mean")    =    sum( tCur, p_res(%1,%2,"fieldPMFP","Quant","",tCur) ) / p_cardtCur ;

*     --- Terrestrial acidification potential
p_res(%1,%2,"totTAP","Quant","",tCur)      =    sum((t_n(tCur,nCur)), p_probn(nCur) *   v_emissionsCatSum.l("TAP",tCur,nCur) );
p_res(%1,%2,"totTAP","Quant","","mean")    =    sum( tCur, p_res(%1,%2,"totTAP","Quant","",tCur) ) / p_cardtCur ;

$$iftheni.herd %herd% == true
  p_res(%1,%2,"entFermTAP","Quant","",tCur)      =    sum((curChain,t_n(tCur,nCur)), p_probn(nCur) *   v_emissionsCat.l(curChain,"entFerm","TAP",tCur,ncur) );
  p_res(%1,%2,"entFermTAP","Quant","","mean")    =    sum( tCur, p_res(%1,%2,"entFermTAP","Quant","",tCur) ) / p_cardtCur ;

  $$iftheni.cat %cattle% == true
    p_res(%1,%2,"pastTAP","Quant","",tCur)       =    sum((curChain,t_n(tCur,nCur)), p_probn(nCur) *   v_emissionsCat.l(curChain,"past","TAP",tCur,ncur) );
    p_res(%1,%2,"pastTAP","Quant","","mean")     =    sum( tCur, p_res(%1,%2,"pastTAP","Quant","",tCur) ) / p_cardtCur ;

    p_res(%1,%2,"totTAPperBeef","Quant","",tCur)  $ p_res(%1,%2,"OQuantBeef","sum","",tCur)
                                                    = p_res(%1,%2,"totTAP","Quant","",tCur) / p_res(%1,%2,"OQuantBeef","sum","",tCur);
    p_res(%1,%2,"totTAPperBeef","Quant","","mean")  = sum( tCur, p_res(%1,%2,"totTAPperBeef","Quant","",tCur) ) / p_cardtCur ;
  $$endif.cat

  p_res(%1,%2,"staStoTAP","Quant","",tCur)      =   sum((curChain,t_n(tCur,nCur)), p_probn(nCur) *   v_emissionsCat.l(curChain,"staSto","TAP",tCur,ncur) );
  p_res(%1,%2,"staStoTAP","Quant","","mean")    =   sum( tCur, p_res(%1,%2,"staStoTAP","Quant","",tCur) ) / p_cardtCur ;

  p_res(%1,%2,"manApplTAP","Quant","",tCur)     =   sum((curChain,t_n(tCur,nCur)), p_probn(nCur) *   v_emissionsCat.l(curChain,"manAppl","TAP",tCur,ncur) );
  p_res(%1,%2,"manApplTAP","Quant","","mean")   =   sum( tCur, p_res(%1,%2,"manApplTAP","Quant","",tCur) ) / p_cardtCur ;
$$endif.herd

p_res(%1,%2,"minApplTAP","Quant","",tCur)       =   sum((curChain,t_n(tCur,nCur)), p_probn(nCur) *   v_emissionsCat.l(curChain,"minAppl","TAP",tCur,ncur) );
p_res(%1,%2,"minApplTAP","Quant","","mean")     =   sum( tCur, p_res(%1,%2,"minApplTAP","Quant","",tCur) ) / p_cardtCur ;

p_res(%1,%2,"inputTAP","Quant","",tCur)         =   sum((curChain,t_n(tCur,nCur)), p_probn(nCur) *   v_emissionsCat.l(curChain,"input","TAP",tCur,ncur) );
p_res(%1,%2,"inputTAP","Quant","","mean")       =   sum( tCur, p_res(%1,%2,"inputTAP","Quant","",tCur) ) / p_cardtCur ;

p_res(%1,%2,"fieldTAP","Quant","",tCur)         =   sum((curChain,t_n(tCur,nCur)), p_probn(nCur) *   v_emissionsCat.l(curChain,"field","TAP",tCur,ncur) );
p_res(%1,%2,"fieldTAP","Quant","","mean")       =   sum( tCur, p_res(%1,%2,"fieldTAP","Quant","",tCur) ) / p_cardtCur ;

*     --- Freshwater eutrophication potential

p_res(%1,%2,"totFEP","Quant","",tCur)           =   sum((t_n(tCur,nCur)), p_probn(nCur) *   v_emissionsCatSum.l("FEP",tCur,nCur) );
p_res(%1,%2,"totFEP","Quant","","mean")         =   sum( tCur, p_res(%1,%2,"totFEP","Quant","",tCur) ) / p_cardtCur ;

$$iftheni.herd %herd% == true
  p_res(%1,%2,"entFermFEP","Quant","",tCur)     =   sum((curChain,t_n(tCur,nCur)), p_probn(nCur) *   v_emissionsCat.l(curChain,"entFerm","FEP",tCur,ncur) );
  p_res(%1,%2,"entFermFEP","Quant","","mean")   =   sum( tCur, p_res(%1,%2,"entFermFEP","Quant","",tCur) ) / p_cardtCur ;

  $$iftheni.cat %cattle% == true
    p_res(%1,%2,"pastFEP","Quant","",tCur)      =   sum((curChain,t_n(tCur,nCur)), p_probn(nCur) *   v_emissionsCat.l(curChain,"past","FEP",tCur,ncur) );
    p_res(%1,%2,"pastFEP","Quant","","mean")    =   sum( tCur, p_res(%1,%2,"pastFEP","Quant","",tCur) ) / p_cardtCur ;

    p_res(%1,%2,"totFEPperBeef","Quant","",tCur)  $ p_res(%1,%2,"OQuantBeef","sum","",tCur)
                                                      = p_res(%1,%2,"totFEP","Quant","",tCur) / p_res(%1,%2,"OQuantBeef","sum","",tCur);
    p_res(%1,%2,"totFEPperBeef","Quant","","mean")    =    sum( tCur, p_res(%1,%2,"totFEPperBeef","Quant","",tCur) ) / p_cardtCur ;
  $$endif.cat

  p_res(%1,%2,"staStoFEP","Quant","",tCur)      =   sum((curChain,t_n(tCur,nCur)), p_probn(nCur) *   v_emissionsCat.l(curChain,"staSto","FEP",tCur,ncur) );
  p_res(%1,%2,"staStoFEP","Quant","","mean")    =   sum( tCur, p_res(%1,%2,"staStoFEP","Quant","",tCur) ) / p_cardtCur ;

  p_res(%1,%2,"manApplFEP","Quant","",tCur)     =   sum((curChain,t_n(tCur,nCur)), p_probn(nCur) *   v_emissionsCat.l(curChain,"manAppl","FEP",tCur,ncur) );
  p_res(%1,%2,"manApplFEP","Quant","","mean")   =   sum( tCur, p_res(%1,%2,"manApplFEP","Quant","",tCur) ) / p_cardtCur ;
$$endif.herd

p_res(%1,%2,"minApplFEP","Quant","",tCur)       =   sum((curChain,t_n(tCur,nCur)), p_probn(nCur) *   v_emissionsCat.l(curChain,"minAppl","FEP",tCur,ncur) );
p_res(%1,%2,"minApplFEP","Quant","","mean")     =   sum( tCur, p_res(%1,%2,"minApplFEP","Quant","",tCur) ) / p_cardtCur ;

p_res(%1,%2,"inputFEP","Quant","",tCur)         =   sum((curChain,t_n(tCur,nCur)), p_probn(nCur) *   v_emissionsCat.l(curChain,"input","FEP",tCur,ncur) );
p_res(%1,%2,"inputFEP","Quant","","mean")       =   sum( tCur, p_res(%1,%2,"inputFEP","Quant","",tCur) ) / p_cardtCur ;

p_res(%1,%2,"fieldFEP","Quant","",tCur)         =   sum((curChain,t_n(tCur,nCur)), p_probn(nCur) *   v_emissionsCat.l(curChain,"field","FEP",tCur,ncur) );
p_res(%1,%2,"fieldFEP","Quant","","mean")       =   sum( tCur, p_res(%1,%2,"fieldFEP","Quant","",tCur) ) / p_cardtCur ;

*     --- Marinewater eutrophication potential
p_res(%1,%2,"totMEP","Quant","",tCur)           =   sum((t_n(tCur,nCur)), p_probn(nCur) *   v_emissionsCatSum.l("MEP",tCur,nCur) );
p_res(%1,%2,"totMEP","Quant","","mean")         =   sum( tCur, p_res(%1,%2,"totMEP","Quant","",tCur) ) / p_cardtCur ;

$$iftheni.herd %herd% == true
  p_res(%1,%2,"entFermMEP","Quant","",tCur)     =   sum((curChain,t_n(tCur,nCur)), p_probn(nCur) *   v_emissionsCat.l(curChain,"entFerm","MEP",tCur,ncur) );
  p_res(%1,%2,"entFermMEP","Quant","","mean")   =   sum( tCur, p_res(%1,%2,"entFermMEP","Quant","",tCur) ) / p_cardtCur ;

  $$iftheni.cat %cattle% == true
    p_res(%1,%2,"pastMEP","Quant","",tCur)      =   sum((curChain,t_n(tCur,nCur)), p_probn(nCur) *   v_emissionsCat.l(curChain,"past","MEP",tCur,ncur) );
    p_res(%1,%2,"pastMEP","Quant","","mean")    =   sum( tCur, p_res(%1,%2,"pastMEP","Quant","",tCur) ) / p_cardtCur ;

    p_res(%1,%2,"totMEPperBeef","Quant","",tCur)  $ p_res(%1,%2,"OQuantBeef","sum","",tCur)
                                                     = p_res(%1,%2,"totMEP","Quant","",tCur) / p_res(%1,%2,"OQuantBeef","sum","",tCur);
    p_res(%1,%2,"totMEPperBeef","Quant","","mean")   = sum( tCur, p_res(%1,%2,"totMEPperBeef","Quant","",tCur) ) / p_cardtCur ;
  $$endif.cat

  p_res(%1,%2,"staStoMEP","Quant","",tCur)      =   sum((curChain,t_n(tCur,nCur)), p_probn(nCur) *   v_emissionsCat.l(curChain,"staSto","MEP",tCur,ncur) );
  p_res(%1,%2,"staStoMEP","Quant","","mean")    =   sum( tCur, p_res(%1,%2,"staStoMEP","Quant","",tCur) ) / p_cardtCur ;

  p_res(%1,%2,"manApplMEP","Quant","",tCur)     =   sum((curChain,t_n(tCur,nCur)), p_probn(nCur) *   v_emissionsCat.l(curChain,"manAppl","MEP",tCur,ncur) );
  p_res(%1,%2,"manApplMEP","Quant","","mean")   =   sum( tCur, p_res(%1,%2,"manApplMEP","Quant","",tCur) ) / p_cardtCur ;
$$endif.herd

p_res(%1,%2,"minApplMEP","Quant","",tCur)      =    sum((curChain,t_n(tCur,nCur)), p_probn(nCur) *   v_emissionsCat.l(curChain,"minAppl","MEP",tCur,ncur) );
p_res(%1,%2,"minApplMEP","Quant","","mean")    =    sum( tCur, p_res(%1,%2,"minApplMEP","Quant","",tCur) ) / p_cardtCur ;

p_res(%1,%2,"inputMEP","Quant","",tCur)        =    sum((curChain,t_n(tCur,nCur)), p_probn(nCur) *   v_emissionsCat.l(curChain,"input","MEP",tCur,ncur) );
p_res(%1,%2,"inputMEP","Quant","","mean")      =    sum( tCur, p_res(%1,%2,"inputMEP","Quant","",tCur) ) / p_cardtCur ;

p_res(%1,%2,"fieldMEP","Quant","",tCur)        =    sum((curChain,t_n(tCur,nCur)), p_probn(nCur) *   v_emissionsCat.l(curChain,"field","MEP",tCur,ncur) );
p_res(%1,%2,"fieldMEP","Quant","","mean")      =    sum( tCur, p_res(%1,%2,"fieldMEP","Quant","",tCur) ) / p_cardtCur ;

* --- Carbon balance
p_res(%1,%2,"carbBal","Quant","",tCur)         =    sum((curCrops,t_n(tCur,nCur)), p_probn(nCur) *   v_humBal.l(tCur,nCur) );
p_res(%1,%2,"CarbBal","Quant","","mean")       =    sum( tCur, p_res(%1,%2,"carbBal","Quant","",tCur) ) / p_cardtCur ;


* --- Sum of different types of emissions, not differentiated into sources

 p_res(%1,%2,"NH3aggr","Quant","",tCur)     =  sum( t_n(tCur,nCur) , p_probn(nCur) *   v_emissionsSum.l("NH3",tCur,nCur) ) ;
 p_res(%1,%2,"NH3aggr","Quant","","mean")   =  sum( t_n(tCur,nCur) , p_probn(nCur) *   v_emissionsSum.l("NH3",tCur,nCur) ) /  p_cardtCur  ;

 p_res(%1,%2,"N2Oaggr","Quant","",tCur)     =  sum( t_n(tCur,nCur) , p_probn(nCur) *   v_emissionsSum.l("N2O",tCur,nCur) +  v_emissionsSum.l("N2Oind",tCur,nCur) ) ;
 p_res(%1,%2,"N2Oaggr","Quant","","mean")   =  sum( t_n(tCur,nCur) , p_probn(nCur) *   v_emissionsSum.l("N2O",tCur,nCur) +  v_emissionsSum.l("N2Oind",tCur,nCur) ) /  p_cardtCur  ;

 p_res(%1,%2,"NOxaggr","Quant","",tCur)     =  sum( t_n(tCur,nCur) , p_probn(nCur) *   v_emissionsSum.l("NOx",tCur,nCur) ) ;
 p_res(%1,%2,"NOxaggr","Quant","","mean")   =  sum( t_n(tCur,nCur) , p_probn(nCur) *   v_emissionsSum.l("NOx",tCur,nCur) ) /  p_cardtCur  ;

 p_res(%1,%2,"N2aggr","Quant","",tCur)      =  sum( t_n(tCur,nCur) , p_probn(nCur) *   v_emissionsSum.l("N2",tCur,nCur) ) ;
 p_res(%1,%2,"N2aggr","Quant","","mean")    =  sum( t_n(tCur,nCur) , p_probn(nCur) *   v_emissionsSum.l("N2",tCur,nCur) ) /  p_cardtCur  ;

* --- Calculation emissions from different sources

 p_res(%1,%2,source,emissions,"",tCur)       = sum((curChain,t_n(tCur,nCur)), p_probn(nCur) * v_emissionsYear.l(curChain,source,emissions,tCur,nCur)  );
 p_res(%1,%2,source,emissions,"","mean")     = sum((curChain,t_n(tCur,nCur)), p_probn(nCur) * v_emissionsYear.l(curChain,source,emissions,tCur,nCur)  )  /  p_cardtCur ;



*  --- Calculation of different emissions per kg of milk

   $$iftheni.dairy %dairyherd% == true

      if (p_res(%1,%2,"milk","Quant","","mean"),

         p_res(%1,%2,"NH3aggrMilk","Quant","",tCur)   $ p_res(%1,%2,"milk","Quant","",tCur)
           = p_res(%1,%2,"NH3aggr","Quant","",tCur)/p_res(%1,%2,"milk","Quant","",tCur);

         p_res(%1,%2,"NH3aggrMilk","Quant","","mean") = p_res(%1,%2,"NH3aggr","Quant","","mean")/p_res(%1,%2,"milk","Quant","","mean");

         p_res(%1,%2,"N2OaggrMilk","Quant","",tCur)  $ p_res(%1,%2,"milk","Quant","",tCur)
           = p_res(%1,%2,"N2Oaggr","Quant","",tCur)/p_res(%1,%2,"milk","Quant","",tCur);

         p_res(%1,%2,"N2OaggrMilk","Quant","","mean")        = p_res(%1,%2,"N2Oaggr","Quant","","mean")/p_res(%1,%2,"milk","Quant","","mean");

         p_res(%1,%2,"NOxaggrMilk","Quant","",tCur)  $ p_res(%1,%2,"milk","Quant","",tCur)
           = p_res(%1,%2,"NOxaggr","Quant","",tCur)/p_res(%1,%2,"milk","Quant","",tCur);

         p_res(%1,%2,"NOxaggrMilk","Quant","","mean") = p_res(%1,%2,"NOxaggr","Quant","","mean")/p_res(%1,%2,"milk","Quant","","mean");

         p_res(%1,%2,"N2aggrMilk","Quant","",tCur)  $ p_res(%1,%2,"milk","Quant","",tCur)
           = p_res(%1,%2,"N2aggr","Quant","",tCur)/p_res(%1,%2,"milk","Quant","",tCur);

         p_res(%1,%2,"N2aggrMilk","Quant","","mean")  = p_res(%1,%2,"N2aggr","Quant","","mean")/p_res(%1,%2,"milk","Quant","","mean");


      );

*     --- Calculation of different emissions per cow

      if (  p_res(%1,%2,"sumHerdCows","Quant","","mean"),


         p_res(%1,%2,"NH3aggrCow","Quant","",tCur)        $ p_res(%1,%2,"sumHerdCows","Quant","",tCur)
                   = p_res(%1,%2,"NH3aggr","Quant","",tCur)/p_res(%1,%2,"sumHerdCows","Quant","",tCur);
         p_res(%1,%2,"NH3aggrCow","Quant","","mean")        = p_res(%1,%2,"NH3aggr","Quant","","mean")/p_res(%1,%2,"sumHerdCows","Quant","","mean");

         p_res(%1,%2,"N2OaggrCow","Quant","",tCur)        $ p_res(%1,%2,"sumHerdCows","Quant","",tCur)
                   = p_res(%1,%2,"N2Oaggr","Quant","",tCur)/p_res(%1,%2,"sumHerdCows","Quant","",tCur);
         p_res(%1,%2,"N2OaggrCow","Quant","","mean")        = p_res(%1,%2,"N2Oaggr","Quant","","mean")/p_res(%1,%2,"sumHerdCows","Quant","","mean");

         p_res(%1,%2,"NOxaggrCow","Quant","",tCur)        $ p_res(%1,%2,"sumHerdCows","Quant","",tCur)
                   = p_res(%1,%2,"NOxaggr","Quant","",tCur)/p_res(%1,%2,"sumHerdCows","Quant","",tCur);
         p_res(%1,%2,"NOxaggrCow","Quant","","mean")        = p_res(%1,%2,"NOxaggr","Quant","","mean")/p_res(%1,%2,"sumHerdCows","Quant","","mean");

         p_res(%1,%2,"N2aggrCow","Quant","",tCur)         $ p_res(%1,%2,"sumHerdCows","Quant","",tCur)
                    = p_res(%1,%2,"N2aggr","Quant","",tCur)/p_res(%1,%2,"sumHerdCows","Quant","",tCur);
         p_res(%1,%2,"N2aggrCow","Quant","","mean")         = p_res(%1,%2,"N2aggr","Quant","","mean")/p_res(%1,%2,"sumHerdCows","Quant","","mean");
      );
   $$endif.dairy

