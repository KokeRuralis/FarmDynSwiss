********************************************************************************
$ontext

   Dairdyn project

   GAMS file : gen_LAMASUS.GMS

   @purpose  : Cost summary results for grassland land use management units (LUM)
   @author   : D.Schaefer, T. Kuhn
   @date     : 18.03.2025
   @since    :
   @refDoc   :
   @seeAlso  :
   @calledBy : exp_starter.gms

$offtext
********************************************************************************

****************************************
*
*    Cost positions
*    CAPRI cost positions: (1) Fertiliser, (2) pesticides, (3) machinery, (4) fuel(6) labour
*    GLOBIOM cost positions: Fertilisier (Mineral), pesticides, machinery, fuel, rent, and labour
*
*    Objective: To determine cost positions per hectare of grassland type
*    Challenge: To disentangle per hectare costs related to the grassland type
*
*    Suffixe have the following meaning:
*               Q - Quantity
*               C - Cost
*               P - Price 
*
*    Units:
*        total (â‚¬/kg/hectare)
*        per_ha
*        Euro_per_kg
*        per_machine      
*
****************************************

* Cost calculation is estimated for average ha of farm. The denominator refelcts the total land, being one land
* management (LUM) in the set up. This is calculated here once to be transparent on the amount of land entering
* the cost calculation. 

p_sumLAMASUS(%1,%2,"Grasland","SilPast","total",tcur) = p_res(%1,%2,"totland","gras","",tCur) 
                                                       + p_res(%1,%2,"totland","past","",tCur); 

* (1) Fertilizer - Mineral fertilizer associated with the grassland type - In %1 or %2 we could insert the LUM and country
* --- (1.1) Nitrogen 
p_sumLAMASUS(%1,%2,"Fertilizer","NitrogenQ","total",tcur) = (p_res(%1,%2,"AHL","Quant","",tCur)  * p_nutInSynt("AHL","N")
                                            + p_res(%1,%2,"ASS","Quant","",tCur) * p_nutInSynt("ASS","N")); 
                                            
p_sumLAMASUS(%1,%2,"Fertilizer","NitrogenQ","per_ha",tcur) = p_sumLAMASUS(%1,%2,"Fertilizer","NitrogenQ","total",tcur) / p_sumLAMASUS(%1,%2,"Grasland","SilPast","total",tcur);


p_sumLAMASUS(%1,%2,"Fertilizer","NitrogenC","total",tcur) = sum(sys, ( p_res(%1,%2,"AHL","Quant","",tCur)  * (p_inputprice("AHL",sys,tCur))
                                            + p_res(%1,%2,"ASS","Quant","",tCur) * (p_inputprice("ASS",sys,tcur))));

p_sumLAMASUS(%1,%2,"Fertilizer","NitrogenC","per_Ha",tcur) = p_sumLAMASUS(%1,%2,"Fertilizer","NitrogenC","total",tcur) 
                                                                        /p_sumLAMASUS(%1,%2,"Grasland","SilPast","total",tcur);

p_sumLAMASUS(%1,%2,"Fertilizer","NitrogenP","Euro_per_kg",tcur) = p_sumLAMASUS(%1,%2,"Fertilizer","NitrogenC","total",tcur) 
                                                                                    / p_sumLAMASUS(%1,%2,"Fertilizer","NitrogenQ","total",tcur);

* --- (1.2) Phosphorus (PK_18_10 - Assumption that 18/28 of the cost of buying one unit of PK_18_10 is allocated to Phosphorus)
p_sumLAMASUS(%1,%2,"Fertilizer","PhosphorusQ","total",tcur) = (p_res(%1,%2,"PK_18_10","sum","",tCur)  * p_nutInSynt("PK_18_10","P")
                                                                 + p_res(%1,%2,"dolophos","sum","",tCur)  * p_nutInSynt("dolophos","P"));
                                           
                                            
p_sumLAMASUS(%1,%2,"Fertilizer","PhosphorusQ","per_Ha",tcur) = p_sumLAMASUS(%1,%2,"Fertilizer","PhosphorusQ","total",tcur)
                                                                                           / p_sumLAMASUS(%1,%2,"Grasland","SilPast","total",tcur);


p_sumLAMASUS(%1,%2,"Fertilizer","PhosphorusC","total",tcur) = sum(sys, p_res(%1,%2,"PK_18_10","sum","",tCur) * p_inputprice("PK_18_10",sys,tCur) * 18/28
                                                                 +   p_res(%1,%2,"dolophos","sum","",tCur) * p_inputprice("dolophos",sys,tCur));

p_sumLAMASUS(%1,%2,"Fertilizer","PhosphorusC","per_Ha",tcur) = p_sumLAMASUS(%1,%2,"Fertilizer","PhosphorusC","total",tcur)
                                                                        /p_sumLAMASUS(%1,%2,"Grasland","SilPast","total",tcur);


p_sumLAMASUS(%1,%2,"Fertilizer","PhosphorusP","Euro_per_kg",tcur) = p_sumLAMASUS(%1,%2,"Fertilizer","PhosphorusC","total",tcur)
                                                                                    / p_sumLAMASUS(%1,%2,"Fertilizer","PhosphorusQ","total",tcur);


* --- (1.3) Potassium  (PK_18_10 - Assumption that 10/28 of the cost of buying one unit of PK_18_10 is allocated to Potassium)
p_sumLAMASUS(%1,%2,"Fertilizer","PotassiumQ","total",tcur) = p_res(%1,%2,"PK_18_10","sum","",tCur)  * 0.1;
                                           
                                            
p_sumLAMASUS(%1,%2,"Fertilizer","PotassiumQ","per_Ha",tcur) = p_sumLAMASUS(%1,%2,"Fertilizer","PotassiumQ","total",tcur)
                                                                                           / p_sumLAMASUS(%1,%2,"Grasland","SilPast","total",tcur);


p_sumLAMASUS(%1,%2,"Fertilizer","PotassiumC","total",tcur) = sum(sys, p_res(%1,%2,"PK_18_10","sum","",tCur) * p_inputprice("PK_18_10",sys,tCur) * 10/28);
                                                                     

p_sumLAMASUS(%1,%2,"Fertilizer","PotassiumC","per_Ha",tcur) = p_sumLAMASUS(%1,%2,"Fertilizer","PotassiumC","total",tcur)
                                                                        /p_sumLAMASUS(%1,%2,"Grasland","SilPast","total",tcur);


p_sumLAMASUS(%1,%2,"Fertilizer","PotassiumP","Euro_per_kg",tcur) = p_sumLAMASUS(%1,%2,"Fertilizer","PotassiumC","total",tcur)
                                                                                    / p_sumLAMASUS(%1,%2,"Fertilizer","PotassiumQ","total",tcur);

* (2) Machinery - Machinery cost as depreciation (v_buymach.l and based on use v_buymachFlex depending on the machinery) - Could be improved with machtype -> machtypeGras (and not the dungGrab extension)
  p_sumLAMASUS(%1,%2,"MachineryC",machtype,"per_machine",tCur) $ (not sameas(machtype,"dungGrab"))     = sum(t_n(tCur,nCur),p_probn(nCur)*p_priceMach(machType,tCur)
                                                                           *(v_buyMach.l(machType,tCur,nCur)
                                                                            +v_buyMachFlex.l(machType,tCur,nCur)));
  p_sumLAMASUS(%1,%2,"Machinery","MachineryC","total",tCur)     = sum(machtype, p_sumLAMASUS(%1,%2,"MachineryC",machtype,"per_machine",tCur));

  p_sumLAMASUS(%1,%2,"Machinery","MachineryC","per_Ha",tCur)     = p_sumLAMASUS(%1,%2,"Machinery","MachineryC","total",tCur)
                                                                       / p_sumLAMASUS(%1,%2,"Grasland","SilPast","total",tcur);   

* (3) Fuel

* (3.1) Diesel from tractor/tractorsmall over v_machNeedGras and the hourly diesel consumption - v_machneedGras is v_machNeed with all animal related machinery use excluded (only for LAMASUS setup)
*       p_machAttr(machtype,"diesel_h") ensures that Diesel values are only given for tractor, as all other have a zero value in that position
p_sumLAMASUS(%1,%2,"DieselQ_Tract",machtype,"per_machine",tcur) = 
             sum((t_n(tCur,nCur)),v_machNeedGras(machtype,"hour",tcur,nCur)  * p_machAttr(machtype,"diesel_h"));
                 
p_sumLAMASUS(%1,%2,"Diesel_Tract","DieselC_tract","total",tcur) = 
                                          sum((sys, t_n(tCur,nCur),machtype), p_sumLAMASUS(%1,%2,"DieselQ_Tract",machtype,"per_machine",tcur) * p_inputprice("diesel",sys,tCur));

p_sumLAMASUS(%1,%2,"Diesel_Tract","DieselC_tract","per_Ha",tcur) = 
                                         p_sumLAMASUS(%1,%2,"Diesel_Tract","DieselC_tract","total",tcur)
                                                / p_sumLAMASUS(%1,%2,"Grasland","SilPast","total",tcur);    


* (3.2) Diesel from machinery which is non-tractor related 
set grasOperation(operation) /sowmachine, roller, weederLight,closeSilo, soilSample, grasReSeeding, mowing, raking, tedding/;

p_sumLAMASUS(%1,%2,"DieselQ_GrasM",operation,"per_machine",tcur) $ sum(sameas(operation, grasOperation),1) = 
             sum((t_n(tCur,nCur), actMachVar,act_rounded_plotSize, op_machType(operation,machType)), v_machNeedGras(machtype,"ha",tcur,nCur) $(not (sameas(machtype,"tractor") AND sameas(machtype,"tractorsmall")))  
                                                                        * op_attr(operation,actMachVar,act_rounded_plotsize,"diesel")); 
            
p_sumLAMASUS(%1,%2,"Diesel_GrasM","DieselC_GrasM","total",tcur) = sum((operation,sys), p_sumLAMASUS(%1,%2,"DieselQ_GrasM",operation,"per_machine",tcur) * p_inputprice("diesel",sys,tCur));
             
p_sumLAMASUS(%1,%2,"Diesel_GrasM","DieselC_GrasM","per_Ha",tcur) = p_sumLAMASUS(%1,%2,"Diesel_GrasM","DieselC_GrasM","total",tcur)
                                                               / p_sumLAMASUS(%1,%2,"Grasland","SilPast","total",tcur);        

* (3.3) Adding Diesel consumption from tractor and other machinery together - Diesel purchase has been so far only associated with Tractor use in buy_ in templ.gms
p_sumLAMASUS(%1,%2,"Diesel","DieselQ","total",tcur) =  
                                                      sum((t_n(tCur,nCur),machtype), p_sumLAMASUS(%1,%2,"DieselQ_Tract",machtype,"per_machine",tcur));  


p_sumLAMASUS(%1,%2,"Diesel","DieselQ","per_ha",tcur) = p_sumLAMASUS(%1,%2,"Diesel","DieselQ","total",tcur)
                                                              / p_sumLAMASUS(%1,%2,"Grasland","SilPast","total",tcur);             
                                                     


p_sumLAMASUS(%1,%2,"Diesel","DieselC","total",tcur) =    
                                                        p_sumLAMASUS(%1,%2,"Diesel_GrasM","DieselC_GrasM","total",tcur) 
                                                       + p_sumLAMASUS(%1,%2,"Diesel_Tract","DieselC_Tract","total",tcur);


p_sumLAMASUS(%1,%2,"Diesel","DieselC","per_Ha",tcur) = p_sumLAMASUS(%1,%2,"Diesel","DieselC","total",tcur)
                                                           / p_sumLAMASUS(%1,%2,"Grasland","SilPast","total",tcur);    
                 
* (4) Labour - (country specific wage rates have to be taken from CAPRI) - DE is shown as an example
parameter p_countryWage(*);
p_countryWage("DE") = 15;

p_sumLAMASUS(%1,%2,"Labour","LabourQ","total",tcur) = p_res(%1,%2,"crops","hours","",tCur);

p_sumLAMASUS(%1,%2,"Labour","LabourQ","per_ha",tcur) = p_res(%1,%2,"crops","hours","",tCur)
                                                               / p_sumLAMASUS(%1,%2,"Grasland","SilPast","total",tcur);

p_sumLAMASUS(%1,%2,"Labour","LabourC","total",tcur)  = p_sumLAMASUS(%1,%2,"Labour","LabourQ","total",tcur) * p_countrywage("DE");
                                            
p_sumLAMASUS(%1,%2,"Labour","LabourC","per_ha",tcur) = p_sumLAMASUS(%1,%2,"Labour","LabourC","total",tcur) /
                                                     p_sumLAMASUS(%1,%2,"Grasland","SilPast","total",tcur) ; 

* (5) Pesticides 
p_sumLAMASUS(%1,%2,"Pesticides","PesticidesC","total",tcur) = sum(phytoSani, p_res(%1,%2,phytoSani,"sum","",tCur));
p_sumLAMASUS(%1,%2,"Pesticides","PesticidesC","per_ha",tcur) = sum(phytoSani, p_res(%1,%2,phytoSani,"sum","",tCur))
                                                                     / p_sumLAMASUS(%1,%2,"Grasland","SilPast","total",tcur);
* (6) Seed

p_sumLAMASUS(%1,%2,"Seed","SeedC","total",tcur) = p_res(%1,%2,"seed","sum","","mean");
p_sumLAMASUS(%1,%2,"Seed","SeedC","per_ha",tcur) = p_res(%1,%2,"seed","sum","","mean") 
                                                    / p_sumLAMASUS(%1,%2,"Grasland","SilPast","total",tcur);
* (7) LIME - Did not find LIME in the model for grassland

display p_sumLamasus;

*execute_unload "N:\em\work1\FarmDyn\FarmDyn_Schaefer\LAMASUS_D53_FarmDyn\results\debug\debug.gdx";
*execute_unload "N:\em\work1\FarmDyn\FarmDyn_Schaefer\LAMASUS_D53_FarmDyn\results\LAMASUS_FarmDyn_Cost_%scenDes%.gdx" p_sumLamasus;
