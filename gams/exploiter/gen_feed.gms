********************************************************************************
$ontext

   Dairdyn project

   GAMS file : GEN_Feed.gms

   @purpose  : Generate summary results for pigs & fattners
   @author   : D.Schaefer
   @date     : 27.01.18
   @since    :
   @refDoc   :
   @seeAlso  :
   @calledBy :

$offtext
********************************************************************************

parameter p_dailyNutrientRes(*,*,*,*) "Daily amount of essential nutrients in kg from simulation results and data requirements";
option kill = p_dailyNutrientRes;

parameter p_dailyNutrientFeed(*,*,*,*) "Daily amount of essential nutrients in a kg DM of the feed mixture from simulation results";
option kill = p_dailyNutrientFeed;

parameter p_dailyFeedRes(*,*,*,*) "Daily amount of feed (FM) for animals in kg ";
option kill = p_dailyFeedRes;

parameter p_dailyFeedDMRes(*,*,*,*) "Daily amount of feed (DM) for animals in kg ";
option kill = p_dailyFeedDMRes;

parameter p_roughPerYear(*,*,*)
option kill = p_roughPerYear;

parameter p_concPerYear(*,*,*)
option kill = p_concPerYear;

parameter p_animalCount(*,*,*);
option kill = p_animalCount;




$iftheni.pig %pigherd% == true

  p_animalCount(herds,"","") =  sum((feedRegime,t,ncur,m), v_herdSize.l(herds,"",feedRegime,t,nCur,m));

  p_dailyNutrientRes(pigHerds,"","SimResult",feedAttr) $( sum((breeds,actHerds(pigHerds,breeds,feedRegime,t,m)),1) $ (not sameas(pigHerds,"pigletsbought"))
                                                 $ (not sameas(pigHerds,"youngsows")) $ (not sameas(pigHerds,"youngpiglets")) $ p_animalCount(pigHerds,"","") )


                                       = sum((feedsPig,feedRegime,t,nCur,m),(v_feedingPig.l(pigHerds,feedsPig,feedRegime,t,nCur,m) / p_animalCount(pigHerds,"",""))
                                                                             * p_feedAttrPig(feedsPig,feedAttr))/30;


  p_dailyNutrientRes(pigHerds,"","DataReq",feedAttr) $( sum((breeds,actHerds(pigHerds,breeds,feedRegime,t,m)),1) $ (not sameas(pigHerds,"pigletsbought"))
                                               $ (not sameas(pigHerds,"youngsows")) $ (not sameas(pigHerds,"youngpiglets")))

                                              =  sum(feedRegime, p_feedReqPig(pigHerds,"normFeed",feedAttr)) / 30;

  p_dailyFeedRes(pigHerds,feedsPig,feedRegime,"SimResult")  $( sum((breeds,actHerds(pigHerds,breeds,feedRegime,t,m)),1) $ (not sameas(pigHerds,"pigletsbought"))
                                                         $ (not sameas(pigHerds,"youngsows")) $ (not sameas(pigHerds,"youngpiglets")) $ p_animalCount(pigHerds,"","") )

                                          = (sum((t,nCur,m),(v_feedingPig.l(pigHerds,feedsPig,feedRegime,t,nCur,m) / p_animalCount(pigHerds,"","")))*1000) / 30 ;



   p_dailyFeedRes(pigHerds,feedsPig,feedRegime,"DataReq")  $( sum((breeds,actHerds(pigHerds,breeds,feedRegime,t,m)),1) $ (not sameas(pigHerds,"pigletsbought"))
                                                          $ (not sameas(pigHerds,"youngsows")) $ (not sameas(pigHerds,"youngpiglets")))

                                              =  p_feedMinPig(pigHerds,feedspig,feedRegime);
$endif.pig

$iftheni.cattle %cattle% == true

  p_animalCount(cattle,feedRegime,reqsPhase)
    =
      (sum((curBreeds,tCur,ncur,m) $ herds_breeds(cattle,curBreeds), v_herdSize.l(cattle,curBreeds,feedRegime,tCur,nCur,m))) $ sameas(reqsPhase, "gen")
    + (sum((curBreeds,tCur,ncur,m) $ herds_breeds(cattle,curBreeds), v_herdsReqsPhase.l(cattle,curBreeds,feedRegime,reqsPhase,m,tCur,ncur))) $ (not sameas(reqsPhase,"gen"))
    ;

  p_dailyFeedRes(cattle,feedRegime,reqsPhase,feeds)
      $ (sum((curBreeds,tCur,nCur,m) $ herds_breeds(cattle,curBreeds),v_feeding.l(cattle,curBreeds,feedRegime,reqsPhase,m,feeds,tCur,nCur))
      $ p_animalCount(cattle,feedRegime,reqsPhase))

    = (sum((curBreeds,tCur,nCur,m) $ herds_breeds(cattle,curBreeds),(v_feeding.l(cattle,curBreeds,feedRegime,reqsPhase,m,feeds,tCur,nCur) / p_animalCount(cattle,feedRegime,reqsPhase)))*1000) / 30.5 ;

  p_dailyFeedDMRes(cattle,feedRegime,reqsPhase,feeds) $ p_dailyFeedRes(cattle,feedRegime,reqsPhase,feeds)
    = p_dailyFeedRes(cattle,feedRegime,reqsPhase,feeds) * p_feedContFMton(feeds,"DM") / 1000;

  option p_dailyFeedRes:5:3:1;
  option p_dailyFeedDMRes:5:3:1;

  p_dailyNutrientRes(cattle,feedRegime,reqsPhase,feedAttr) $ sum(feeds, p_dailyFeedRes(cattle,feedRegime,reqsPhase,feeds))
      = sum(feeds, p_dailyFeedRes(cattle,feedRegime,reqsPhase,feeds) * p_feedContFMg(feeds,feedAttr) / 1000);

  p_dailyNutrientRes(cattle,feedRegime,reqsPhase,feedAttr) $ (p_dailyNutrientRes(cattle,feedRegime,feedAttr,reqsPhase)
                                                           $ (sameas(feedAttr,"ME") or sameas(feedAttr,"NEL") or sameas(feedAttr,"RNB")))
      = p_dailyNutrientRes(cattle,feedRegime,reqsPhase,feedAttr) * 1000;

  p_dailyNutrientRes(cattle,"DataReq",reqsPhase,feedAttr) $ sum(curBreeds $ herds_breeds(cattle,curBreeds), p_reqsPhaseLength(cattle,curBreeds,reqsPhase))
      = sum(curBreeds $ herds_breeds(cattle,curBreeds), p_reqsPhase(cattle,curBreeds,reqsPhase,feedAttr) / p_reqsPhaseLength(cattle,curBreeds,reqsPhase));

  p_dailyNutrientFeed(cattle,feedRegime,reqsPhase,feedAttr) $ sum(feeds, p_dailyFeedDMRes(cattle,feedRegime,reqsPhase,feeds))
    = p_dailyNutrientRes(cattle,feedRegime,reqsPhase,feedAttr) / sum(feeds, p_dailyFeedDMRes(cattle,feedRegime,reqsPhase,feeds));

  p_roughPerYear(cattle,feedRegime,reqsPhase) $ sum((roughages),p_dailyFeedRes(cattle,feedRegime,reqsPhase,roughages))
    = sum((roughages),p_dailyFeedRes(cattle,feedRegime,reqsPhase,roughages)
      * p_reqsPhaseLength(cattle,"%basBreed%",reqsPhase)/1000);

  p_concPerYear(cattle,feedRegime,reqsPhase) $ sum((concentrates), p_dailyFeedRes(cattle,feedRegime,reqsPhase,concentrates))
    = sum((concentrates),p_dailyFeedRes(cattle,feedRegime,reqsPhase,concentrates)
      * 365/1000);
$endif.cattle

option p_dailyNutrientFeed:5:3:1;
option p_dailyNutrientRes:5:3:1;


if ( card(p_animalCount),
  display p_animalCount;
  display p_dailyNutrientRes, p_dailyFeedRes, p_dailyFeedDMRes, p_dailyNutrientFeed,p_roughPerYear,p_concPerYear;
);
